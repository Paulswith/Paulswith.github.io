<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <!-- PACE Progress Bar START -->
  
    <script src="https://raw.githubusercontent.com/HubSpot/pace/v1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://github.com/HubSpot/pace/raw/master/themes/orange/pace-theme-flash.css">
  
  

  <!-- PACE Progress Bar START -->

  
  <title>In &#39;flight of thought&#39;</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta name="description" content="Paulswith&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="In &#39;flight of thought&#39;">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="In &#39;flight of thought&#39;">
<meta property="og:description" content="Paulswith&apos;s blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="In &#39;flight of thought&#39;">
<meta name="twitter:description" content="Paulswith&apos;s blog">
  
    <link rel="alternate" href="/atom.xml" title="In &#39;flight of thought&#39;" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css" >
  <link rel="stylesheet" href="/css/hiero.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >
  

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/my.css">
  <!-- Google Adsense -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
      (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "c696510b523841e638bb8225e25825e42e181bbf",
          enable_page_level_ads: true
      });
  </script>
  
</head>

<script>
var themeMenus = {};

  themeMenus["/"] = "Home"; 

  themeMenus["/archives"] = "Archives"; 

  themeMenus["/categories"] = "Catégories"; 

  themeMenus["/tags"] = "Mot-clés"; 

  themeMenus["/about"] = "About"; 

</script>


  <body>


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="In &#39;flight of thought&#39;" rel="home"> In &#39;flight of thought&#39; </a>
            
          </h1>

          
            <div class="site-description">Paulswith&#39;s blog</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/categories">Catégories</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">Mot-clés</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>


  <div id="originBgDiv" style="background: #fff; width: 100%;">

      <div style="max-height:600px; overflow: hidden;  display: flex; display: -webkit-flex; align-items: center;">
        <img id="originBg" width="100%" alt="" src="">
      </div>

  </div>

  <script>
  function setAboutIMG(){
      var imgUrls = "css/images/pose.jpg,https://source.unsplash.com/collection/954550/1920x1080".split(",");
      var random = Math.floor((Math.random() * imgUrls.length ));
      if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
        document.getElementById("originBg").src=imgUrls[random];
      } else {
        document.getElementById("originBg").src='/' + imgUrls[random];
      }
  }
  bgDiv=document.getElementById("originBgDiv");
  if(location.pathname.match('about')){
    setAboutIMG();
    bgDiv.style.display='block';
  }else{
    bgDiv.style.display='none';
  }
  </script>



  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main">
  
    <article id="post-aliyun-ddns设置定时监控更新"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/10/14/aliyun-ddns设置定时监控更新/">aliyun-ddns设置定时监控更新</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/10/14/aliyun-ddns设置定时监控更新/" class="article-date">
	  <time datetime="2019-10-14T05:43:33.000Z" itemprop="datePublished">October 14, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="获取程序"><a href="#获取程序" class="headerlink" title="获取程序"></a>获取程序</h2><p><a href="https://github.com/Paulswith/aliyun-ddns/releases" target="_blank" rel="external">click-me</a><br><code>aliyun-ddns</code>用rust写的，自己和朋友也一直在用，喜欢的话不留余力请star, 有问题和建议也希望您提个issue知会我下。</p>
<h2 id="获取AccessKeyID和AccessSecret"><a href="#获取AccessKeyID和AccessSecret" class="headerlink" title="获取AccessKeyID和AccessSecret"></a>获取AccessKeyID和AccessSecret</h2><ol>
<li>登录：<a href="https://ak-console.aliyun.com" target="_blank" rel="external">ak-console.aliyun.com</a> </li>
<li>使用其中一种方法创建AK, secret大多都是创建的时候可见，注意保存<ol>
<li>继续用主账号创建AK秘钥，点击，然后根据提示创建，阿里现在不是很推荐了(安全性问题)<br><img src="/2019/10/14/aliyun-ddns设置定时监控更新/72317FBF-9157-47EC-8E76-CD9F4B206533.png" alt="d87429f6a41d823f7934ecca213918b9"></li>
<li>点击<code>开始使用子用户AK</code>，按照操作设置后，在<a href="https://ram.console.aliyun.com/users" target="_blank" rel="external">用户管理</a>添加用户，分配权限(注意权限)，生成AK<br><img src="/2019/10/14/aliyun-ddns设置定时监控更新/16717882-10C4-485D-BDD6-699A08D4CFF2.png" alt="95ceb1aa9d52644a03d45737de14f411"><br><img src="/2019/10/14/aliyun-ddns设置定时监控更新/200DE1AB-AE2F-4B81-B947-D4408A9645A0.png" alt="c4bc43ee5978875c5a0eebe945877c3c"></li>
</ol>
</li>
</ol>
<h2 id="配置aliyun-ddns"><a href="#配置aliyun-ddns" class="headerlink" title="配置aliyun-ddns"></a>配置aliyun-ddns</h2><ol>
<li><p>登录到<a href="https://dc.console.aliyun.com/next/index#/domain/list/all-domain" target="_blank" rel="external">域名页面</a>，设置子域名，步骤： 进入解析-&gt; 添加记录 -&gt; 设置子域名 保存<br><img src="/2019/10/14/aliyun-ddns设置定时监控更新/2AFD2E77-42AC-43CD-8D1A-534C88D08EA1.png" alt="b0a2bac2b6811cbe155750eaf1c36946"><br><img src="/2019/10/14/aliyun-ddns设置定时监控更新/2FD4434C-D020-4D63-A7E0-EE862795FF9E.png" alt="42c7c13ba5dea7d20bff08fd486d9a34"></p>
</li>
<li><p>回到程序aliyun-ddns，打开common_conf, 编辑config.yaml， 对于获取公网IP的无需变动<br><img src="/2019/10/14/aliyun-ddns设置定时监控更新/69647DA5-0CAC-418D-93F7-B8D1CA025DBF.png" alt="3561667e6e02a56ebb6527b44d485c98"></p>
</li>
</ol>
<h2 id="配置windows定时任务"><a href="#配置windows定时任务" class="headerlink" title="配置windows定时任务"></a>配置windows定时任务</h2><ol>
<li>打开控制面板找到管理工具<br><img src="/2019/10/14/aliyun-ddns设置定时监控更新/5AAE9978-B065-4564-981D-043D1984E754.png" alt="8ae4fa46789c0da6133bc8d7eee56b9c"></li>
<li>打开定时任务<br><img src="/2019/10/14/aliyun-ddns设置定时监控更新/A53D5F6B-93B9-41BC-84C1-0ACEF9F14E3E.png" alt="484d28c4fe334d15cbd4278f3a9a3152"></li>
<li>下面的请看图片了<br> <img src="/2019/10/14/aliyun-ddns设置定时监控更新/6D121EDD-44CF-49F9-B894-C7DB769FC630.png" alt="e2c598e3f6071806da9e0623c1883d68"><br> <img src="/2019/10/14/aliyun-ddns设置定时监控更新/06755D1D-989B-48BA-B5D9-3DB0D26765CA.png" alt="065dd736333dd66d3b8d8a02a1a037ff"><br> <img src="/2019/10/14/aliyun-ddns设置定时监控更新/D52CD485-46A0-4E92-8FAC-E6A68E5CE36A.png" alt="574503dcb7e9d0846fa61144a6369710"><br> <img src="/2019/10/14/aliyun-ddns设置定时监控更新/10D31248-0A21-45C5-90E5-171389BA73D9.png" alt="064228eb6639cb0463d3354f8ce37b65"><br> <img src="/2019/10/14/aliyun-ddns设置定时监控更新/2A4BC3F1-DE9E-4E22-BE1C-2938C858627C.png" alt="3f86a1cdf817595dbfb669f29b683fa8"></li>
<li>关于运行情况，查看日志文件，默认由common_conf/log4rs.yaml控制，在程序根目录的logs下。这里控制着日志级别，debug运行后无错误提示，请改为info节省磁盘空间<br> <img src="/2019/10/14/aliyun-ddns设置定时监控更新/B2BBED0C-73E5-40D6-9ED8-19B93A000A0E.png" alt="559fec3e31905027b8a89e1291bd1f16"><br> <img src="/2019/10/14/aliyun-ddns设置定时监控更新/441282A8-F3E2-4CE7-B1A9-12657EEF13EC.png" alt="9ee9451f9e57a67456435ffa98cf25ce"></li>
</ol>
<h2 id="配置linux定时任务"><a href="#配置linux定时任务" class="headerlink" title="配置linux定时任务"></a>配置linux定时任务</h2><p>linux就是依赖自带的<a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html" target="_blank" rel="external">crontab定时任务</a>，只要程序配置与windows相同<br>参照上方Tutorial设置好crontab后，启动该程序的crontab指令可以如下(每5分钟检测一次)):<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">*/5 * * * * <span class="built_in">cd</span> /path/to/program/ &amp;&amp; ./aliyun-ddns_linux</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/MyProgram/">MyProgram</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DDNS/">DDNS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Windows/">Windows</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-读书记-原则"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/06/20/读书记-原则/">读书记-&lt;原则&gt;</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2018/06/20/读书记-原则/" class="article-date">
	  <time datetime="2018-06-20T12:36:37.000Z" itemprop="datePublished">June 20, 2018</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>计划今年看24本书, 如果盖过前面半年看过的技术书籍, 我决定一切从头开始计算, 所幸的是我新的工作距离家里挺远, 但却拥有从头开到尾的地铁(大多时候能占到座位), 利用好零碎的时间, 做出生活的改变. 也感谢现任女友的和我的那次争吵, 是她让我知道, 面对不足应该不逃避,  就像&lt;原则&gt;表述的那样, 做头脑极度开放的人.</p>
<p><del>本书是我今年的第1/24本书, <strong>Ray·Dalio</strong> &lt;&lt;原则&gt;&gt;</del>:</p>
<p>文章分成了三步,第一部是讲的瑞的生活, 从一无所有到福布斯名列前茅. 我相信读同一本书, 在不同的时候, 不同的人与不同生活经历背景下, 感悟都是不同的.</p>
<p>第一部分讲述了他一生的历程, 从独生子女到抱孙子, 从低谷到福布斯.</p>
<p>瑞从一个美国的中产阶级(似乎没有), 家庭对他影响是极大的, 从初中的时候开始体验赚钱的不易, 开始打零工送报纸. 我觉得每个小孩都必须要在这里年纪经历一些历练. 瑞在刚步入大学的时候, 失去了他最爱的人-他母亲的离世. 在大学的时候, 他对于经济学是无比热爱的, 找到有爱好的专业是十分重要. 毕业后经历了上班族到自主创业的工程, 文中提及多次他的起起伏伏, 最低谷的时候曾是一个人孤军奋斗, 也曾是背负骂名(1982年他对于公众预言一场萧条,但结果没有发生,导致他胜败名列, 钱财殆尽), 但依然在低谷重新走出来, 这是多么伟大的毅力. </p>
<p>第二部分讲的是他的生活原则, 这也是让我很震撼的部分所有, 也是解释了他如今成就的原因所在. </p>
<ul>
<li>我对其印象深刻的, 是其中讲到的”两个你”, 这在我之前的理解中, 是上帝视觉(还有一种说法, 是把自己当成一只宠物, 来自一本自制力的书籍). 瑞谈及的两个你, 也是大脑的两个层次, 一个较低的层次控制着情感, 我们的冲动, 情绪来自他.  而高级的那个, 他是理智的, 主要在一些理性的时候, 他才会现身. 他所描述的, 我们应该时刻提示自己这两个层次的存在, 当你情绪很失控的时候, 你要想到低级的大脑开始搞事情了,此时能做’想到’这件事的, 正是你高级的大脑做的. 我们需要在生活, 逐步的训练自己, 让高级的大脑灵活用起来. 在面临很多情绪化的问题的时候, 你需要马上高级大脑接管模式. 在生活训练他并不断强化.</li>
<li>在痛苦中成长, 做进化的自己. 这与我的观点大抵是一致的, “不进则退”, 默认的认知中, 我们在对抗很多的一些改变, 能力上的, “不得不”学习新的东西, 新的编程, 新的公式逻辑, 新的环境, 新的概念等,  “人类总是恐惧未知的东西”, 但是否真的想要前进, 这决定着是否要迎接改变. 在痛苦成长, 而瑞把痛苦当然粮食, 他觉得痛苦意味着是前进的步伐, 啃食痛苦, 反思痛苦, 从而改善然前进.</li>
<li>做到头脑”极度开放”, 这似乎是瑞终生的信条了, 但这确实很抽象.  这蕴含在任何领域都是方方面面的, 对真诚的渴望, 对生活的上进, 对为人处世的心胸开旷等等,  如果我哪天能做到这样子, 大概也是一帆况景了.</li>
</ul>
<p>第三部分是工作的原则, 这直接的成就让他当前的企业拥有了成就并步入福布斯, 而企业的话题总是文化-制度, 他曾是企业的顶梁柱, 一切的标准所在. 我也不曾是一个管理的身份, (如果说做到班长算是有管理经验的话另说). 以下是我在文章看到并走进脑子思考的部分.</p>
<ul>
<li>瑞表达的一个概念中, 是成为了管理者, 那么就相当于你接管了一部机器, 你所看到是整部机器的运转, 宏观到微观, 微观到宏观的切换. 总会遇到问题的, 但”机器操纵者”应该在遇到问题的时候想更多, 是哪个机器出了问题, 是零件问题, 还是制度问题, 其他部分有没有问题, 处理会不会导致其他部分问题, 看起来更强调宏观的影响.</li>
<li>瑞在管理上, 像是一个杀伐的军事家, 他的观点表达的是, 一个人如果在”机器中”确实出现了问题, 哪怕是你所爱之人, 那也要对他开枪, 这于他于机器都是好的.</li>
<li>打造一个求真的团队, 团队的人都是有共同的目标, 为了彼此更好的, 会喜欢别人对他提出的意见.  其实这绝对是不容易的, 一个团队中不可能都是这样子的人, 所以瑞在接收新血液的时候, 有心理等各种测试. </li>
</ul>
<p>总结这篇文章,  以我目前的所往所思, 用最好的上帝视觉管理自己, “不进则退”.<br>另一个, 也是瑞希望看完这本书的人做到, 把自己的原则写下来, 遵守并改善他, 这对于我似乎还不是个时机.<br>最好, 我也希望在我所理解的&lt;原则&gt;里, 做一个<strong>头脑极度开放的人</strong>.</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/读书笔记/">读书笔记</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/2018年读的书/">2018年读的书</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-xcode9之后的打包方式"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/06/05/xcode9之后的打包方式/">xcode9之后的打包方式</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2018/06/05/xcode9之后的打包方式/" class="article-date">
	  <time datetime="2018-06-05T02:10:38.000Z" itemprop="datePublished">June 5, 2018</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="XCode8-3之前的打包"><a href="#XCode8-3之前的打包" class="headerlink" title="XCode8.3之前的打包"></a>XCode8.3之前的打包</h2><p><a href="https://github.com/webfrogs/xcode_shell/blob/master/ipa-build" target="_blank" rel="external">https://github.com/webfrogs/xcode_shell/blob/master/ipa-build</a><br>阅读链接上的这个脚本, 可以理解构建三部曲为:</p>
<ol>
<li>Clean build cache</li>
<li>编译出.archive </li>
<li>xcrun打包为.ipa文件</li>
</ol>
<p>第三步是和XCode9差异最大的地方, 先记住这里:<br><img src="/2018/06/05/xcode9之后的打包方式/xcrun.png" alt=""></p>
<h2 id="XCode9之后的打包"><a href="#XCode9之后的打包" class="headerlink" title="XCode9之后的打包"></a>XCode9之后的打包</h2><p>听说是8.3之后就不一样的了.<br>细化上面的三个步骤为:</p>
<h4 id="Clean-Build-Cache"><a href="#Clean-Build-Cache" class="headerlink" title="Clean Build Cache:"></a>Clean Build Cache:</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xcodebuild clean -workspace $workspace -scheme $scheme -configuration $configuration</div></pre></td></tr></table></figure>
<p>与xcode8无任何差异.</p>
<h4 id="编译-生成-xcarchive"><a href="#编译-生成-xcarchive" class="headerlink" title="编译,生成.xcarchive"></a>编译,生成.xcarchive</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">xcodebuild archive -workspace $workspace -scheme $scheme -configuration \</div><div class="line"><span class="meta">$</span><span class="bash">configuration -archivePath <span class="variable">$archivePath</span> -destination generic/platform=ios \</span></div><div class="line">CODE_SIGN_IDENTITY="$code_sign_indentity"</div></pre></td></tr></table></figure>
<p>这里可以不需要这个参数, <code>CODE_SIGN_IDENTITY=&quot;$code_sign_indentity&quot;</code>.</p>
<h4 id="将-xcarchive生成-IPA"><a href="#将-xcarchive生成-IPA" class="headerlink" title="将.xcarchive生成.IPA"></a>将.xcarchive生成.IPA</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">xcodebuild -exportArchive -archivePath $archivePath \</div><div class="line">-exportPath $exportPath -destination generic/platform=ios \</div><div class="line">-exportOptionsPlist $exportOptionPlist -allowProvisioningUpdates</div></pre></td></tr></table></figure>
<p>这一步有特殊的地方, 就是<code>-exportOptionsPlist $exportOptionPlist</code>, 它的格式如下, 做了下扼要的说明, 官网能找到它的说明文档:<br><img src="/2018/06/05/xcode9之后的打包方式/plist.png" alt=""></p>
<p>我确信你按照我的复制去执行, 基本很难打包成功, 如果想要打包成功, 你得用XCode手动打包一遍, 选择对应的打包方式<code>method</code>, 然后生成的路径下, 就附带了这个<code>ExportOptions.plist</code>:</p>
<ol>
<li>打开xcode, Product -&gt; Archive 等待编译完成, 自己弹出可选框</li>
<li>如图操作导出:<br><img src="/2018/06/05/xcode9之后的打包方式/exportPlist.png" alt=""></li>
</ol>
<p>成功后, 同级目录下就存在<code>ExportOptions.plist</code>文件了, 其中默认bitCode是YES的, 你可以选择改为NO开提升效率.</p>
<h2 id="脚本化"><a href="#脚本化" class="headerlink" title="脚本化"></a>脚本化</h2><p>脚本地址: <a href="https://github.com/Paulswith/ToolsScript/tree/master/package_script_xcode9" target="_blank" rel="external">https://github.com/Paulswith/ToolsScript/tree/master/package_script_xcode9</a></p>
<h4 id="稍微优化了一下"><a href="#稍微优化了一下" class="headerlink" title="稍微优化了一下:"></a>稍微优化了一下:</h4><ol>
<li>添加<code>xcpretty</code>美化xcodebuild出来的那团东西, 安装请执行<code>gem install xcpretty</code></li>
<li>所有操作,有添加日志记录,你需要制定日志路径</li>
<li>若打包后的目录下存在类似的旧包, <code>判断方式是监测是否存在与scheme同名的文件</code>, 有的话备份. 你需要制定部分后存储的路径.<br>展示效果:<br><img src="/2018/06/05/xcode9之后的打包方式/xcode9之后的打包方式" alt=""></li>
</ol>
<h4 id="使用指南"><a href="#使用指南" class="headerlink" title="使用指南"></a>使用指南</h4><ul>
<li>根目录下执行 <code>xcodebuild -list</code>, 把下面<code>user-define</code>这些配置下:<br><img src="/2018/06/05/xcode9之后的打包方式/config.png" alt=""></li>
<li>项目根目录生成<code>package</code>文件夹, 将<strong>脚本</strong>和<strong>ExportOptions.plist</strong>放进去.</li>
<li>给脚本添加执行权限<code>chmod +x package.sh</code>, 执行.</li>
</ul>
<p>补充: 我直接项目是<code>.xcworkspace</code>的, 因为很少有项目还是单target的吧~ 如果是, 你需要自行改下, 或email我~(dobby确实还是懒)</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/MachineLearning/">MachineLearning</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/迁移学习移植IOS/">迁移学习移植IOS</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-机器学习迁移模型到IOS"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/02/25/机器学习迁移模型到IOS/">机器学习迁移模型到IOS</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2018/02/25/机器学习迁移模型到IOS/" class="article-date">
	  <time datetime="2018-02-24T17:01:47.000Z" itemprop="datePublished">February 25, 2018</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a href="https://paulswith.github.io/2018/02/24/%E8%BF%81%E7%A7%BB%E5%AD%A6%E4%B9%A0InceptionV3/" target="_blank" rel="external">https://paulswith.github.io/2018/02/24/%E8%BF%81%E7%A7%BB%E5%AD%A6%E4%B9%A0InceptionV3/</a> 上文记录了如何从一个别人训练好的模型, 切入我们自己的图片, 改为我们自己的模型.<br>本来以为移植到手机很简单, 但是不简单的是我的模型本身就是迁移学习别人的模型,有很多莫名其面的坑,  在CoreML经历了N个坑后,1点14分我搞掂了.</p>
</blockquote>
<p><strong> 项目源码和转换源码已经上传到git.</strong><br><a href="https://github.com/Paulswith/machineLearningIntro/tree/master/classification_101" target="_blank" rel="external">https://github.com/Paulswith/machineLearningIntro/tree/master/classification_101</a></p>
<h3 id="转化为mlmodel"><a href="#转化为mlmodel" class="headerlink" title="转化为mlmodel"></a>转化为mlmodel</h3><p>说说转换为mlmodel的工具有两个:</p>
<ul>
<li>coremltools, 它目前只支持五种模型的转换, 不包括tensorflow:<br><img src="/2018/02/25/机器学习迁移模型到IOS/tools.png" alt=""></li>
<li>若你跟我一样是tensorflow , 那么必须使用tfcoreml<br>  <a href="https://github.com/tf-coreml" target="_blank" rel="external">https://github.com/tf-coreml</a> 有安装方法.<br>  转换Example: <a href="https://github.com/tf-coreml/tf-coreml/tree/master/examples" target="_blank" rel="external">https://github.com/tf-coreml/tf-coreml/tree/master/examples</a> </li>
</ul>
<p><strong> 接着往下看: </strong></p>
<h4 id="是否是graph-pb"><a href="#是否是graph-pb" class="headerlink" title="是否是graph-pb?"></a>是否是graph-pb?</h4><p>如果你跟我一样, 训练的模型, 从tensorflow的代码保存下来的, 调用的:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">saver.save(sess, MODEL_SAVEPATH, global_step=<span class="number">50</span>)</div></pre></td></tr></table></figure></p>
<p>它并不会保存出一个pb文件, 其中的.meta也需要其他方式转换似乎也可以, 我没有尝试过.<br>用这个方法, 你需要在上方代码的下面加两行,就可以继续:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> i %SAVE_EPOCH == <span class="number">0</span>:</div><div class="line">                    tf.train.write_graph(sess.graph, MODEL_SAVE_DIR, <span class="string">'model.pbtxt'</span>)</div></pre></td></tr></table></figure></p>
<h4 id="pdtxt固化为pd"><a href="#pdtxt固化为pd" class="headerlink" title="pdtxt固化为pd"></a>pdtxt固化为pd</h4><p>操作参考链接<a href="https://www.jianshu.com/p/091415b114e2" target="_blank" rel="external">https://www.jianshu.com/p/091415b114e2</a><br>我是直接使用的bezel, 编译tensorflow源码后, 直接使用, 其中参数跟着填, 需要注意的是output_node:<br><img src="/2018/02/25/机器学习迁移模型到IOS/guhua.png" alt=""></p>
<h4 id="导入化图"><a href="#导入化图" class="headerlink" title="导入化图"></a>导入化图</h4><p>导入图和查看图的节点信息:<br> 如果你的图不属于pb文件, 那么就会在导入图的时候报错的.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> open(TF_MODEL_FILE, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</div><div class="line">    serialized = f.read()</div><div class="line">tf.reset_default_graph()</div><div class="line">original_gdef = tf.GraphDef()</div><div class="line">original_gdef.ParseFromString(serialized)</div><div class="line"></div><div class="line"><span class="comment">##2 可以在这里查看到全部的图信息(前提是你有转换成功)</span></div><div class="line"><span class="keyword">with</span> tf.Graph().as_default() <span class="keyword">as</span> g:</div><div class="line">    tf.import_graph_def(original_gdef, name=<span class="string">''</span>)</div><div class="line">    ops = g.get_operations()</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000</span>):</div><div class="line">            print(<span class="string">'op id &#123;&#125; : op name: &#123;&#125;, op type: "&#123;&#125;"'</span>.format(str(i),ops[i].name, ops[i].type))</div><div class="line">    <span class="keyword">except</span>:</div><div class="line">        print(<span class="string">"全部节点已打印完毕."</span>)</div><div class="line">        <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<h4 id="预处理节点"><a href="#预处理节点" class="headerlink" title="预处理节点"></a>预处理节点</h4><p>其实这一步个人不是很清楚很知道它做了什么,但确是不得不做的. 最后的大小看着也不像是”减包”<br>需要注意两点:</p>
<ul>
<li>input_node_names: 这里填写的节点从上方的代码可以打印看得到的, 实际在训练模型的时候, 我们直接喂图片的节点是在”import/DecodeJpeg/contents”, 而这里”必须是import/Mul”.</li>
<li>output_node_names: 因为模型是剪切拼接的, 这跟tensorflow直接调用是一样的节点.<br><strong> 最后生成一个完整的pb文件. </strong><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">input_node_names = [<span class="string">'import/Mul'</span>, <span class="string">'BottleneckInputPlaceholder'</span>]   <span class="comment"># 本来以为是import/DecodeJpeg/contents, 实际上是Mul(tfcoreml-git上说的)</span></div><div class="line">output_node_names = [<span class="string">'import/pool_3/_reshape'</span>,<span class="string">'final_train_ops/softMax_last'</span>]  <span class="comment"># 想要保存的节点 , 'final_train_ops/softMax_last'</span></div><div class="line"></div><div class="line">gdef = strip_unused_lib.strip_unused(</div><div class="line">        input_graph_def = original_gdef,</div><div class="line">        input_node_names = input_node_names,</div><div class="line">        output_node_names = output_node_names,</div><div class="line">        placeholder_type_enum = dtypes.float32.as_datatype_enum)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">with</span> gfile.GFile(FROZEN_MODEL_FILE, <span class="string">"wb"</span>) <span class="keyword">as</span> f:</div><div class="line">    f.write(gdef.SerializeToString())</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="开始转换"><a href="#开始转换" class="headerlink" title="开始转换"></a>开始转换</h4><ul>
<li><p>input_tensor_shapes: 是placeholder 和 input节点, 方括号的第一个参数是batch大小,代表一张一张的喂给它. 字典里面这两个, 对应生成后的InceptionV3_input的两个属性.</p>
</li>
<li><p>output_tensor_names: 训练后得到的节点, 对应生成后的InceptionV3_output的两个属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">input_tensor_shapes = &#123;</div><div class="line">                        <span class="string">"import/Mul:0"</span>:[<span class="number">1</span>,<span class="number">299</span>,<span class="number">299</span>,<span class="number">3</span>],          <span class="comment"># batch size is 1</span></div><div class="line">                        <span class="string">"BottleneckInputPlaceholder:0"</span>:[<span class="number">1</span>,<span class="number">2048</span>],</div><div class="line">                       &#125;</div><div class="line">output_tensor_names = [<span class="string">'import/pool_3/_reshape:0'</span>,<span class="string">'final_train_ops/softMax_last:0'</span>]</div><div class="line"></div><div class="line"><span class="comment"># Call the converter. This may take a while</span></div><div class="line">coreml_model = tfcoreml.convert(</div><div class="line">        tf_model_path=FROZEN_MODEL_FILE,</div><div class="line">        mlmodel_path=COREML_MODEL_FILE,</div><div class="line">        input_name_shape_dict=input_tensor_shapes,</div><div class="line">        output_feature_names=output_tensor_names,</div><div class="line">        image_input_names = [<span class="string">'import/Mul:0'</span>],</div><div class="line">        red_bias = <span class="number">-1</span>,</div><div class="line">        green_bias = <span class="number">-1</span>,</div><div class="line">        blue_bias = <span class="number">-1</span>,</div><div class="line">        image_scale = <span class="number">2.0</span>/<span class="number">255.0</span>)</div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>上方具体的参数可以在方法看得到,后面四个参数就是我们输入图片时候的均值化,  还有个特殊的参数<code>class_labels</code>, output后的模型可以直接索引到标签, 但是在实践过程中, 我这个本身是迁移别人的学习的模型并起不到作用.</p>
</blockquote>
<p>执行完成后生成文件:<br><img src="/2018/02/25/机器学习迁移模型到IOS/model.png" alt=""></p>
<h3 id="ios-code调用"><a href="#ios-code调用" class="headerlink" title="ios-code调用"></a>ios-code调用</h3><h4 id="了解模型"><a href="#了解模型" class="headerlink" title="了解模型:"></a>了解模型:</h4><p>首先, 直接将inceptionV3.mlmodel拖入到工程:<br>导入头文件, <code>inceptionV3.h</code>, 点开查看:<br><img src="/2018/02/25/机器学习迁移模型到IOS/inout.png" alt=""></p>
<p>他们之间的关系是, <strong>inception_v3_input导入 -&gt; 启动inception_v3.model训练 -&gt; 得到inception_v3_output</strong> 分别提供了一个实例化方法.</p>
<h4 id="开始代码"><a href="#开始代码" class="headerlink" title="开始代码"></a>开始代码</h4><p>首先确认他们之间的调用方向 层次, 我直接是参考tensorflow加载的顺序, 只要理解了, 就可以直接调用了:<br>这是Python的调用方法:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">poo3_frist = sess.run(poo3, feed_dict=&#123;inpiut_x: image&#125;)   <span class="comment"># 按照模型的顺序要, 先喂给它图片, 然后图片提取到瓶颈的tensor</span></div><div class="line">result     = sess.run(predict, feed_dict=&#123;change_input:poo3_frist&#125;) <span class="comment"># 瓶颈的tensor再转入input传入, 得到我们最后的predict</span></div></pre></td></tr></table></figure></p>
<p>如果参照tensorflow加载模型的做法, 我们直接是一张图片, 得到一个run到pool3, 但实际CoreML只给我们生成了一个实例方法:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">instancetype</span>)initWithBottleneckInputPlaceholder__0:(MLMultiArray *)BottleneckInputPlaceholder__0 import__Mul__0:(CVPixelBufferRef)import__Mul__0;</div></pre></td></tr></table></figure></p>
<p>方法必须要传入一个<code>MLMultiArray</code>, 而且shape必须一致的. 最后我直接调用<code>MLMultiArray</code>的方法,生成一个0值的2048shape</p>
<p><strong>预测部分的, 完整核心代码</strong> 均有详细的注释说明<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">- (inception_v3 *)tfModel &#123;</div><div class="line">    <span class="keyword">if</span> (!_tfModel) &#123;</div><div class="line">        <span class="comment">// 1 加载模型, 本身代码会调用init的时候, 方法会调用initWithContentsOfURL, 找到inception文件进行初始化</span></div><div class="line">        _tfModel = [[inception_v3 alloc] init];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> _tfModel;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)predictWithFoodImage:(<span class="built_in">UIImage</span> *)foodImage</div><div class="line">&#123;</div><div class="line">    <span class="comment">// step1: 标准为size, 转为可传入的参数.</span></div><div class="line">    <span class="built_in">UIImage</span> *img = [foodImage scaleToSize:<span class="built_in">CGSizeMake</span>(<span class="number">299</span>, <span class="number">299</span>)];             <span class="comment">// 转换为可传参的图片大小</span></div><div class="line">    CVPixelBufferRef refImage = [[<span class="built_in">UIImage</span> new] pixelBufferFromCGImage:img];  <span class="comment">// 转换为可传参的类型</span></div><div class="line"></div><div class="line">    </div><div class="line">    <span class="comment">// step2.1: 由于一开始是没有BottleneckInputPlaceholder, 直接0值初始一个传入</span></div><div class="line">    MLMultiArray *holder = [[MLMultiArray alloc] initWithShape:@[@<span class="number">2048</span>] dataType:MLMultiArrayDataTypeDouble error:<span class="literal">nil</span>];</div><div class="line">    <span class="comment">// step2.2: 启动预测, 预测完成后得到import__pool_3___reshape__0</span></div><div class="line">    inception_v3Output *output = [<span class="keyword">self</span>.tfModel predictionFromBottleneckInputPlaceholder__0:holder import__Mul__0:refImage error:<span class="literal">nil</span>];</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="comment">// step3: 从第二步, 完整得到了想要的BottleneckInputPlaceholder, 直接代入, 图片也代入.</span></div><div class="line">    inception_v3Output *output1 = [<span class="keyword">self</span>.tfModel predictionFromBottleneckInputPlaceholder__0:output.import__pool_3___reshape__0 import__Mul__0:refImage error:<span class="literal">nil</span>];</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">// step4: 从final_train_ops__softMax_last__0提取预测结果</span></div><div class="line">    MLMultiArray *__final = output1.final_train_ops__softMax_last__0;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> poAccu:__final];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="调用摄像头进行图片获取"><a href="#调用摄像头进行图片获取" class="headerlink" title="调用摄像头进行图片获取"></a>调用摄像头进行图片获取</h4><p>通过整合代码层次, 代码调用也封装好了, 方便代用:<br> 从简书上拿到别人写好的调用摄像头拍照<a href="https://www.jianshu.com/p/62d69d89fa43" target="_blank" rel="external">https://www.jianshu.com/p/62d69d89fa43</a>, 提取了下代码:<br>主要逻辑:<br>拍照后重置大小展示到view,  异步进行模型预测, 回到主线程展示label结果.<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//触发事件：拍照</span></div><div class="line">- (<span class="keyword">void</span>)addCamera</div><div class="line">&#123;</div><div class="line">    <span class="built_in">UIImagePickerController</span> *picker = [[<span class="built_in">UIImagePickerController</span> alloc] init];</div><div class="line">    picker.delegate = <span class="keyword">self</span>;</div><div class="line">    picker.allowsEditing = <span class="literal">YES</span>; <span class="comment">//可编辑</span></div><div class="line">    <span class="comment">//判断是否可以打开照相机</span></div><div class="line">    <span class="keyword">if</span> ([<span class="built_in">UIImagePickerController</span> isSourceTypeAvailable:<span class="built_in">UIImagePickerControllerSourceTypeCamera</span>]) &#123;</div><div class="line">        <span class="comment">//摄像头</span></div><div class="line">        picker.sourceType = <span class="built_in">UIImagePickerControllerSourceTypeCamera</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//否则打开照片库</span></div><div class="line">        picker.sourceType = <span class="built_in">UIImagePickerControllerSourceTypePhotoLibrary</span>;</div><div class="line">    &#125;</div><div class="line">    [<span class="keyword">self</span> presentViewController:picker animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - UIImagePickerControllerDelegate</span></div><div class="line"></div><div class="line"><span class="comment">//拍摄完成后要执行的代理方法</span></div><div class="line">- (<span class="keyword">void</span>)imagePickerController:(<span class="built_in">UIImagePickerController</span> *)picker didFinishPickingMediaWithInfo:(<span class="built_in">NSDictionary</span> *)info</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSString</span> *mediaType = [info objectForKey:<span class="built_in">UIImagePickerControllerMediaType</span>];</div><div class="line">    <span class="keyword">if</span> ([mediaType isEqualToString:<span class="string">@"public.image"</span>]) &#123;</div><div class="line">        <span class="comment">//得到照片</span></div><div class="line">        <span class="built_in">UIImage</span> *image = [info objectForKey:<span class="built_in">UIImagePickerControllerOriginalImage</span>];</div><div class="line">        image = [image scaleToSize:<span class="keyword">self</span>.imageView.frame.size];</div><div class="line">        <span class="keyword">self</span>.imageView.image = image;</div><div class="line">        <span class="comment">// 异步处理, 不要占用主线程:</span></div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_queue_create(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</div><div class="line">            <span class="built_in">NSString</span> *preString = [<span class="keyword">self</span>.prediction predictWithFoodImage:image];</div><div class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">                <span class="keyword">self</span>.preLabel.text = preString;</div><div class="line">            &#125;);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//进入拍摄页面点击取消按钮</span></div><div class="line">- (<span class="keyword">void</span>)imagePickerControllerDidCancel:(<span class="built_in">UIImagePickerController</span> *)picker</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><p>制作gif, 直接看图片: 或者上面链接从我的git上下载源码:<br><img src="/2018/02/25/机器学习迁移模型到IOS/1.png?r=20" alt=""><img src="/2018/02/25/机器学习迁移模型到IOS/2.png?r=20" alt=""><img src="/2018/02/25/机器学习迁移模型到IOS/3.png?r=20" alt=""><img src="/2018/02/25/机器学习迁移模型到IOS/4.png?r=20" alt=""></p>
<p>[<code>好困, 该睡觉了...</code>]</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/MachineLearning/">MachineLearning</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/迁移学习移植IOS/">迁移学习移植IOS</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-迁移学习InceptionV3"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/02/24/迁移学习InceptionV3/">迁移学习InceptionV3</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2018/02/24/迁移学习InceptionV3/" class="article-date">
	  <time datetime="2018-02-24T02:37:01.000Z" itemprop="datePublished">February 24, 2018</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>手动画过AlexNet类似的模型,直接在后面加了一层[,class]的全连接层, 结果预测准确率是90%左右. 当然不是很满意. 于是乎开始各种方法寻求最准的CNN<br>偶然间发现通过迁移学习大赛上高分的作品,进行迁移学习可以让我们拥有更精准的准确率,于是有了本文.<br>总结:: 学会如何迁移优秀的模型来为自己所用!<br><strong> 文章讲述的colab源码已经共享, 请点击下方链接查看即可.</strong><br><a href="https://drive.google.com/file/d/1ahJtJvuHDGh4oS4lyNG0NdtqZuyns4J6/view?usp=sharing" target="_blank" rel="external">https://drive.google.com/file/d/1ahJtJvuHDGh4oS4lyNG0NdtqZuyns4J6/view?usp=sharing</a></p>
</blockquote>
<h4 id="迁移准备"><a href="#迁移准备" class="headerlink" title="迁移准备"></a>迁移准备</h4><h5 id="模型选择准备"><a href="#模型选择准备" class="headerlink" title="模型选择准备"></a>模型选择准备</h5><p>首先当然是选择一款高效的模型,查阅了部分资料, 发现googleNet是2014年ILSVRC挑战赛获得冠军, 错误率降低到6.67%, 另一个名字也是InceptionV1, V3就是它优化后的第三代, 错误率更低<br>模型下载:<br><a href="https://storage.googleapis.com/download.tensorflow.org/models/inception_dec_2015.zip" target="_blank" rel="external">https://storage.googleapis.com/download.tensorflow.org/models/inception_dec_2015.zip</a> 并解压得到.pd文件</p>
<p>执行下方代码, 可以打印出pb文件的全部节点:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">tf_model_path = <span class="string">'/Users/dobby/Desktop/inception_dec_2015/tensorflow_inception_graph.pb'</span></div><div class="line"><span class="keyword">with</span> open(tf_model_path, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</div><div class="line">    serialized = f.read()</div><div class="line">tf.reset_default_graph()</div><div class="line">original_gdef = tf.GraphDef()</div><div class="line">original_gdef.ParseFromString(serialized)</div><div class="line"></div><div class="line"><span class="comment">##2 可以在这里查看到全部的图信息(前提是你有转换成功)</span></div><div class="line"><span class="keyword">with</span> tf.Graph().as_default() <span class="keyword">as</span> g:</div><div class="line">    tf.import_graph_def(original_gdef, name=<span class="string">''</span>)</div><div class="line">    ops = g.get_operations()</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000</span>):</div><div class="line">            print(<span class="string">'op id &#123;&#125; : op name: &#123;&#125;, op type: "&#123;&#125;"'</span>.format(str(i),ops[i].name, ops[i].type))</div><div class="line">    <span class="keyword">except</span>:</div><div class="line">        <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<p>需要关注的输入层:</p>
<p><img src="/2018/02/24/迁移学习InceptionV3/input.png" alt=""></p>
<p>和需要被修改最后一层的全连接层:<br><img src="/2018/02/24/迁移学习InceptionV3/fl.png" alt=""></p>
<p>我们需要接入到这一层, 然后修改后面的node, 修改这一层原本是[2048, 1000] , 现在需要为我们自己的[2048, n_classes] , 我们自己需要分类的大小</p>
<h5 id="训练环境准备"><a href="#训练环境准备" class="headerlink" title="训练环境准备"></a>训练环境准备</h5><p>训练环境我选择的是colab, google的免费GPU, 部署上传下载到colab可以见:<a href="https://paulswith.github.io/2018/02/01/%E9%83%A8%E7%BD%B2TensorFlow%E5%88%B0Colaboratory/" target="_blank" rel="external">https://paulswith.github.io/2018/02/01/%E9%83%A8%E7%BD%B2TensorFlow%E5%88%B0Colaboratory/</a></p>
<p>免费的GPU当然很快, 但是坑超巨多, 如何你的VPN不稳定, 就很容易导致断连, 数据模型无法被保存,所以我封装一个小代码块, 在训练区间,保存之后调该方法上传到google-drive:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">colab_to_drive</span><span class="params">(file_path, save_name)</span>:</span></div><div class="line">  <span class="string">'''</span></div><div class="line"><span class="string">   ** 从Colab到drive ** </span></div><div class="line"><span class="string">  '''</span></div><div class="line">  auth.authenticate_user()</div><div class="line">  drive_service = build(<span class="string">'drive'</span>, <span class="string">'v3'</span>)</div><div class="line">  file_metadata = &#123;</div><div class="line">    <span class="string">'name'</span>: save_name,</div><div class="line">    <span class="string">'mimeType'</span>: <span class="string">'text/plain'</span></div><div class="line">  &#125;</div><div class="line">  media = MediaFileUpload(file_path, </div><div class="line">                          mimetype=<span class="string">'text/plain'</span>,</div><div class="line">                          resumable=<span class="keyword">True</span>)</div><div class="line">  drive_service.files().create(body=file_metadata,</div><div class="line">                               media_body=media,</div><div class="line">                               fields=<span class="string">'id'</span>).execute()</div><div class="line">  print(<span class="string">"传输完成."</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_demol</span><span class="params">()</span>:</span></div><div class="line">  <span class="string">'''</span></div><div class="line"><span class="string">   ** 封装上传 **</span></div><div class="line"><span class="string">  '''</span></div><div class="line">  time_str = datetime.now().strftime(<span class="string">'_%d_%H_%M_%S'</span>)</div><div class="line">  name = <span class="string">'RSM_'</span>+time_str+<span class="string">'.gz'</span></div><div class="line">  tar_cmd = <span class="string">'tar zcvf &#123;a&#125; &#123;b&#125;'</span>.format(a=name, b=MODEL_SAVE_DIR)</div><div class="line">  rm_cmd  = <span class="string">'rm -rf &#123;&#125;'</span>.format(name)</div><div class="line">  get_ipython().system(tar_cmd)</div><div class="line">  colab_to_drive(name, name)</div><div class="line">  get_ipython().system(rm_cmd)</div><div class="line">  print(<span class="string">"上传成功,包名为"</span>,name)</div><div class="line"></div><div class="line"><span class="comment"># upload_demol()</span></div></pre></td></tr></table></figure></p>
<h4 id="hardCode训练"><a href="#hardCode训练" class="headerlink" title="hardCode训练"></a>hardCode训练</h4><p>当然方法一开始我也是模糊的, 代码参考来自:<br><a href="http://www.cnblogs.com/hellcat/p/6909269.html" target="_blank" rel="external">http://www.cnblogs.com/hellcat/p/6909269.html</a><br>十分感谢前人种树,  方法基本是通用的, 让我学会了如何迁移其他的模型</p>
<hr>
<p>但是跑起来是有地方会报错的, 做了修改:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_test_bottlenecks</span><span class="params">(sess,image_lists,n_class,jpeg_data_tensor,bottleneck_tensor)</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line"><span class="string">    获取全部的测试数据,计算输出</span></div><div class="line"><span class="string">    :param sess: </span></div><div class="line"><span class="string">    :param image_lists: </span></div><div class="line"><span class="string">    :param n_class: </span></div><div class="line"><span class="string">    :param jpeg_data_tensor: </span></div><div class="line"><span class="string">    :param bottleneck_tensor: </span></div><div class="line"><span class="string">    :return:                   瓶颈输出 &amp; label</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    bottlenecks  = []</div><div class="line">    ground_truths = []</div><div class="line">    label_name_list = list(image_lists.keys())</div><div class="line">    <span class="comment">#  ** 原先方法会报错:</span></div><div class="line">    <span class="comment">#     for label_index,label_name in enumerate(image_lists[label_name_list]):</span></div><div class="line">    <span class="comment">#  **修改如下(3行):</span></div><div class="line">    label_index = random.randrange(n_class)  <span class="comment"># 标签索引随机生成</span></div><div class="line">    label_name = label_name_list[label_index]</div><div class="line">    label_index= label_name_list.index(label_name)</div><div class="line">   category = <span class="string">'testing'</span></div><div class="line">    <span class="keyword">for</span> index, unused_base_name <span class="keyword">in</span> enumerate(image_lists[label_name][category]): <span class="comment"># 索引, &#123;文件名&#125;</span></div><div class="line">        bottleneck = get_or_create_bottleneck(</div><div class="line">            sess, image_lists, label_name, index,</div><div class="line">            category, jpeg_data_tensor, bottleneck_tensor)</div><div class="line">        ground_truth = np.zeros(n_class, dtype=np.float32)</div><div class="line">        ground_truth[label_index] = <span class="number">1.0</span></div><div class="line">        bottlenecks.append(bottleneck)</div><div class="line">        ground_truths.append(ground_truth)</div><div class="line">    <span class="keyword">return</span> bottlenecks, ground_truths</div></pre></td></tr></table></figure></p>
<h4 id="迁移方法"><a href="#迁移方法" class="headerlink" title="迁移方法"></a>迁移方法</h4><p>几个核心的方法mark下:</p>
<h5 id="加载获取用得到的tensor"><a href="#加载获取用得到的tensor" class="headerlink" title="加载获取用得到的tensor"></a>加载获取用得到的tensor</h5><p>我们需要获取 图片的输入-&gt; 想断点的这两个节点的tensor<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 1. 图加载模型</span></div><div class="line"><span class="keyword">with</span> open(os.path.join(MODEL_DIR, MODEL_FILE), <span class="string">'rb'</span>) <span class="keyword">as</span> f:            </div><div class="line">        graph_def = tf.GraphDef()                                        </div><div class="line">        graph_def.ParseFromString(f.read())                               </div><div class="line">        </div><div class="line"><span class="comment"># 2.导入图, 且从图上读取tensor, return_elements=[BOTTLENECK_TENSOR_NAME,JPEG_DATA_TENSOR_NAME]) 让返回这个tensor</span></div><div class="line"><span class="comment"># 方便我们runsession ,返回后续tensor</span></div><div class="line">bottleneck_tensor,jpeg_data_tensor = tf.import_graph_def(            </div><div class="line">    graph_def,</div><div class="line">    return_elements=[BOTTLENECK_TENSOR_NAME,JPEG_DATA_TENSOR_NAME])</div></pre></td></tr></table></figure></p>
<h5 id="拿到断点tensor"><a href="#拿到断点tensor" class="headerlink" title="拿到断点tensor"></a>拿到断点tensor</h5><p>上面我们获取到了输入tensor和断点tensor, 操作的步骤如同我们直接调用它的模型是一样的, 按照它们先前的格式将图片输入,然后然后它在我们想要的断点节点返回内容<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_bottleneck_on_images</span><span class="params">(sess,image_data,jpeg_data_tensor,bottleneck_tensor)</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line"><span class="string">    使用加载的训练好的Inception-v3模型处理一张图片，得到这个图片的特征向量。</span></div><div class="line"><span class="string">    :param sess:              会话句柄</span></div><div class="line"><span class="string">    :param image_data:        图片文件句柄</span></div><div class="line"><span class="string">    :param jpeg_data_tensor:  输入张量句柄</span></div><div class="line"><span class="string">    :param bottleneck_tensor: 瓶颈张量句柄</span></div><div class="line"><span class="string">    :return:                  瓶颈张量值</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    bottleneck_values = sess.run(bottleneck_tensor,feed_dict=&#123;jpeg_data_tensor:image_data&#125;)</div><div class="line">    print(bottleneck_values.shape) <span class="comment"># 从这里也能知道它返回的shape</span></div><div class="line">    bottleneck_values = np.squeeze(bottleneck_values)</div><div class="line">    <span class="keyword">return</span> bottleneck_values</div></pre></td></tr></table></figure></p>
<h5 id="定义新网络"><a href="#定义新网络" class="headerlink" title="定义新网络"></a>定义新网络</h5><p>从上面拿到了需要断点的tensor, 它返回shape是[None, 2048], 第一坑placeholder留给它<br>第二个placeholder, 是我们的label, 只需要定义为[None, n_classes]<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">bottleneck_input   = tf.placeholder(tf.float32, [<span class="keyword">None</span>,BOTTLENECK_TENSOR_SIZE], name=<span class="string">'BottleneckInputPlaceholder'</span>)</div><div class="line">ground_truth_input = tf.placeholder(tf.float32, [<span class="keyword">None</span>,n_class], name=<span class="string">'GroundTruthInput'</span>)</div><div class="line"><span class="comment"># 上面的操作后,我们定义好自己的全连接层,接入即可</span></div><div class="line"><span class="keyword">with</span> tf.name_scope(<span class="string">'final_train_ops'</span>):</div><div class="line">    <span class="comment"># Weight-bias初始化</span></div><div class="line">    Weights = tf.Variable(tf.truncated_normal([BOTTLENECK_TENSOR_SIZE,n_class],stddev=<span class="number">0.001</span>)) </div><div class="line">    biases  = tf.Variable(tf.zeros([n_class]))</div><div class="line">    logits  = tf.matmul(bottleneck_input,Weights) + biases</div><div class="line">    final_tensor = tf.nn.softmax(logits, name=<span class="string">'softMax_last'</span>)</div><div class="line">tf.add_to_collection(name=<span class="string">'final_tensor'</span>, value=final_tensor)</div></pre></td></tr></table></figure></p>
<h5 id="定义常规的优化器"><a href="#定义常规的优化器" class="headerlink" title="定义常规的优化器"></a>定义常规的优化器</h5><p>这一步都是通用的, pass哈<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cross_entropy = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits_v2(logits=logits,labels=ground_truth_input))</div><div class="line">train_step    = tf.train.RMSPropOptimizer(LEARNING_RATE).minimize(cross_entropy)</div><div class="line"><span class="comment"># 正确率</span></div><div class="line"><span class="keyword">with</span> tf.name_scope(<span class="string">'evaluation'</span>):</div><div class="line">    correct_prediction = tf.equal(tf.argmax(final_tensor,<span class="number">1</span>,name=<span class="string">'argmax_softMax_last'</span>),tf.argmax(ground_truth_input,<span class="number">1</span>))</div><div class="line">    evaluation_step    = tf.reduce_mean(tf.cast(correct_prediction,tf.float32))</div></pre></td></tr></table></figure></p>
<h4 id="踩过的坑"><a href="#踩过的坑" class="headerlink" title="踩过的坑"></a>踩过的坑</h4><h5 id="batchSize"><a href="#batchSize" class="headerlink" title="batchSize"></a>batchSize</h5><p>我做的是101分类, batchSize对于梯队下降是起到很重要的作用的, 但对于定义多少却是个难题(因为之前都是10分类大小的, 大多定义batchSize=30太随意), 为什么这么关注:<br><strong>batch数太小，而类别又比较多的时候，真的可能会导致loss函数震荡而不收敛，尤其是在你的网络比较复杂的时候</strong><br><strong>batch太大, 导致内存利用紧张</strong><br>最后解决方法, 参考文章:<br><a href="https://www.zhihu.com/question/32673260" target="_blank" rel="external">https://www.zhihu.com/question/32673260</a><br>最后选择的是batchSize = 101</p>
<h5 id="国外网络不稳定-导致容易掉线"><a href="#国外网络不稳定-导致容易掉线" class="headerlink" title="国外网络不稳定,导致容易掉线"></a>国外网络不稳定,导致容易掉线</h5><p>因为colab是需要墙外访问, 当网络不稳定断开的时候, 我们重新进入环境就必须重启它, 导致跑着的变量代码必须重新启动. 这是很难办.最好用两个方法解决:<br>1, 让数据接着跑:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">            sess.run(tf.global_variables_initializer())</div><div class="line">            saver = tf.train.Saver()</div><div class="line">            <span class="keyword">if</span> keepon:</div><div class="line">                print(<span class="string">'继续加载模型:'</span>)</div><div class="line">                saver.restore(sess, tf.train.latest_checkpoint(MODEL_SAVE_DIR))</div></pre></td></tr></table></figure></p>
<blockquote>
<p>good job</p>
</blockquote>
<p>2, 善于保存,善于上传到driver<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> i % <span class="number">1000</span> == <span class="number">0</span>:</div><div class="line">                    print(<span class="string">"进行存储上传"</span>)</div><div class="line">                    tf.train.write_graph(sess.graph, MODEL_SAVE_DIR, <span class="string">'model.pbtxt'</span>)</div><div class="line">                    upload_demol()</div><div class="line">                saver.save(sess, MODEL_SAVEPATH, global_step=<span class="number">50</span>) <span class="comment"># 50次保存一次</span></div></pre></td></tr></table></figure></p>
<h5 id="优化器的坑"><a href="#优化器的坑" class="headerlink" title="优化器的坑"></a>优化器的坑</h5><p>如果你查看了上面blog的作者, 他使用的:<code>GradientDescentOptimizer</code>, 跑了几万次迭代后, 容易陷入局部参数. 当然也有进行过, placeHolder-LR, 但是情况还不是很乐观, 可能GSD确实不适合我.<br>你可以看到我最后选择的<code>RMSPropOptimizer</code>, 这是一类自适应学习率, 参考文章:<br><a href="http://ycszen.github.io/2016/08/24/SGD%EF%BC%8CAdagrad%EF%BC%8CAdadelta%EF%BC%8CAdam%E7%AD%89%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%E5%92%8C%E6%AF%94%E8%BE%83/" target="_blank" rel="external">http://ycszen.github.io/2016/08/24/SGD%EF%BC%8CAdagrad%EF%BC%8CAdadelta%EF%BC%8CAdam%E7%AD%89%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%E5%92%8C%E6%AF%94%E8%BE%83/</a></p>
<p>替换为RMS后的效果很是不错(之所以有部分高震荡, 是因为断网重连后, 它还没适应下去,所以loss依然很高, 正常现象除非你网络稳定,loss也会很好看~)<br><img src="/2018/02/24/迁移学习InceptionV3/loss.png" alt=""></p>
<h4 id="加载模型识别"><a href="#加载模型识别" class="headerlink" title="加载模型识别"></a>加载模型识别</h4><p>识别率基本是满足的了, 达到了95%以上, 下一步是迁移到IOS的APP上, 拿张图片show一下看准不准:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line">__author = <span class="string">''</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># ***********************define***********************</span></div><div class="line">MODEL_PATH   = <span class="string">'/Users/dobby/TEMP/SaveData/model/101_class_model.ckpt-50.meta'</span></div><div class="line">MODEL_DIR    =  <span class="string">'/Users/dobby/TEMP/SaveData/model'</span></div><div class="line">image_path   = <span class="string">'/Users/dobby/Desktop/pisa.jpeg'</span></div><div class="line">CATO_PATH    = <span class="string">'/Users/dobby/TEMP/SaveData/model/catogory.info'</span></div><div class="line">catogo_list  = open(CATO_PATH, <span class="string">'r'</span>).read().split(<span class="string">'|'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># ***********************LOADGraph***********************</span></div><div class="line">sess = tf.Session()</div><div class="line">saver = tf.train.import_meta_graph(MODEL_PATH)</div><div class="line">saver.restore(sess, tf.train.latest_checkpoint(MODEL_DIR))</div><div class="line">graph = tf.get_default_graph()</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># ***********************Define-Node***********************</span></div><div class="line">inpiut_x     = graph.get_tensor_by_name(<span class="string">'import/DecodeJpeg/contents:0'</span>)</div><div class="line">poo3         = graph.get_tensor_by_name(<span class="string">'import/pool_3/_reshape:0'</span>)</div><div class="line">change_input = graph.get_tensor_by_name(<span class="string">'BottleneckInputPlaceholder:0'</span>)</div><div class="line">predict      = graph.get_tensor_by_name(<span class="string">'final_train_ops/softMax_last:0'</span>)</div><div class="line"></div><div class="line">print(<span class="string">'加载模型成功'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">classification_photo</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># step 打开图片切换格式</span></div><div class="line"></div><div class="line">    image = tf.gfile.FastGFile(image_path, <span class="string">'rb'</span>).read()        <span class="comment"># inceptionV3不需要转换图片, 它自己换处理图片</span></div><div class="line">    poo3_frist = sess.run(poo3, feed_dict=&#123;inpiut_x: image&#125;)   <span class="comment"># 按照模型的顺序要, 先喂给它图片, 然后图片提取到瓶颈的tensor</span></div><div class="line">    result = sess.run(predict, feed_dict=&#123;change_input:poo3_frist&#125;) <span class="comment"># 瓶颈的tensor再转入input传入, 得到我们最后的predict</span></div><div class="line">    ar = np.array(result).flatten().tolist()</div><div class="line">    inde = ar.index(max(ar))</div><div class="line">    print(<span class="string">"it's a &#123;&#125; photo"</span>.format(catogo_list[inde]))</div><div class="line"></div><div class="line">classification_photo()</div></pre></td></tr></table></figure></p>
<p><img src="/2018/02/24/迁移学习InceptionV3/succeed.png" alt=""></p>
<h4 id="预告"><a href="#预告" class="headerlink" title="预告"></a>预告</h4><p>将训练好的模型移动到移动端, 基本已经完成,期待更新吧.</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/MachineLearning/">MachineLearning</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/迁移学习/">迁移学习</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-部署TensorFlow到Colaboratory"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/02/01/部署TensorFlow到Colaboratory/">部署TensorFlow到Colaboratory</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2018/02/01/部署TensorFlow到Colaboratory/" class="article-date">
	  <time datetime="2018-02-01T06:48:23.000Z" itemprop="datePublished">February 1, 2018</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>一个二分类的机器学习, 用TensorFlow写的, 刚好看到google提供的免费褥羊毛GPU, 虽然坑很多, 但还是部署上去了,GPU效率真的比CPU强的多多.<br><a href="https://colab.research.google.com/notebook#fileId=/v2/external/notebooks/io.ipynb&amp;scrollTo=sOm9PFrT8mGG" target="_blank" rel="external">官方完整的帮助连接</a>在这里,注意上面的代码是基于Python2的, 我用的python3</p>
</blockquote>
<h3 id="数据集准备"><a href="#数据集准备" class="headerlink" title="数据集准备"></a>数据集准备</h3><h4 id="CSV之类的轻量数据集"><a href="#CSV之类的轻量数据集" class="headerlink" title="CSV之类的轻量数据集"></a>CSV之类的轻量数据集</h4><p>PASS, 有即可</p>
<h4 id="TFRecord重量数据集"><a href="#TFRecord重量数据集" class="headerlink" title="TFRecord重量数据集"></a>TFRecord重量数据集</h4><p>可以类似我这样子, 将数据存储到目录下<code>Datasets</code>下, 推荐tar压缩<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar zcvf Datasets.gz Datasets</div></pre></td></tr></table></figure></p>
<p>自行配置好谷歌Drive, 链接<a href="https://www.google.com/drive/" target="_blank" rel="external">https://www.google.com/drive/</a><br>下载符合电脑版本, 把数据集存入同步到云端.</p>
<h3 id="如何上传"><a href="#如何上传" class="headerlink" title="如何上传"></a>如何上传</h3><p>打开你的Colaboratory-new一个jupyter脚本.</p>
<h4 id="小文件上传"><a href="#小文件上传" class="headerlink" title="小文件上传"></a>小文件上传</h4><p><em>for Python2:</em><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> files</div><div class="line"></div><div class="line"><span class="comment"># 你需填的:</span></div><div class="line">FILE_NAME = <span class="string">'想保存到Colaboratory的文件名'</span></div><div class="line"></div><div class="line">uploaded = files.upload()</div><div class="line"><span class="keyword">with</span> open(FILE_NAME, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</div><div class="line">    file.write(uploaded[uploaded.keys()[<span class="number">0</span>]])</div></pre></td></tr></table></figure></p>
<p><em>but for Python3:</em><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> files</div><div class="line"></div><div class="line"><span class="comment"># 你需填的:</span></div><div class="line">FILE_NAME = <span class="string">'想保存到Colaboratory的文件名'</span></div><div class="line"></div><div class="line">uploaded = files.upload()</div><div class="line"><span class="keyword">with</span> open(FILE_NAME, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</div><div class="line">    file.write(uploaded[list[uploaded.keys()][<span class="number">0</span>]])</div></pre></td></tr></table></figure></p>
<blockquote>
<p>对应的python执行上述代码后, 会出现<code>Choose file</code>按钮, 选择本地文件确认即可上传, 默认在当前路径, 可用<code>!ls -l</code>查看下</p>
</blockquote>
<h4 id="大文件上传"><a href="#大文件上传" class="headerlink" title="大文件上传"></a>大文件上传</h4><p><em>下面开始我就没有试过python2了,都是基于python3</em></p>
<p>如果是大文件上传, 就按照前面的准备, 我们已经把文件传到了GoogleDrive云盘.<br>Now, 在浏览器打开Drive找到那个文件, 右键-&gt;查看共享链接: -&gt; 拷贝id=后面这个key, 粘贴到下方代码的位置<br><img src="/2018/02/01/部署TensorFlow到Colaboratory/shareLinke.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 这行代码相当于unix,会去帮我们安装这个包</span></div><div class="line">!pip install -U -q PyDrive</div><div class="line"></div><div class="line"><span class="keyword">from</span> pydrive.auth <span class="keyword">import</span> GoogleAuth</div><div class="line"><span class="keyword">from</span> pydrive.drive <span class="keyword">import</span> GoogleDrive</div><div class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> auth</div><div class="line"><span class="keyword">from</span> oauth2client.client <span class="keyword">import</span> GoogleCredentials</div><div class="line"></div><div class="line"><span class="comment"># 你需填的:</span></div><div class="line">PACKAGE_ID = <span class="string">'key粘贴到这里'</span></div><div class="line">PACKAGE_NAME = <span class="string">'drive文件的名字还是Colaboratory将存储的名字呢,你自己试试, 我就是填drive对应的名字'</span></div><div class="line"></div><div class="line"></div><div class="line">auth.authenticate_user()</div><div class="line">gauth = GoogleAuth()</div><div class="line">gauth.credentials = GoogleCredentials.get_application_default()</div><div class="line">drive = GoogleDrive(gauth)</div><div class="line"></div><div class="line">downloaded = drive.CreateFile(&#123;<span class="string">'id'</span>:PACKAGE_ID&#125;)</div><div class="line">downloaded.GetContentFile(PACKAGE_NAME)</div><div class="line">print(<span class="string">'Transpose succeed.'</span>)</div></pre></td></tr></table></figure></p>
<blockquote>
<p>执行上述代码, 会弹出一个授权链接和一个授权码输入框, 授权链接授权后会给你这串授权码,粘贴回车即可.依然可以用<code>!ls -l</code>查看下, <code>Colaboratory</code>有自带一些命令的, 在/bin下, 所以可以用tar命令进行解压:<code>tar czvf Datasets.gz</code></p>
</blockquote>
<h3 id="训练后的内容数据如何下载"><a href="#训练后的内容数据如何下载" class="headerlink" title="训练后的内容数据如何下载"></a>训练后的内容数据如何下载</h3><p>训练后的模型-tensorBoardLog等文件我们会把它下载下来, 以便我们后续使用. so, 这里来记录下如何下载下来</p>
<h4 id="小文件"><a href="#小文件" class="headerlink" title="小文件"></a>小文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> files</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 你需要填的:</span></div><div class="line">FILE_PATH = <span class="string">'下载的文件路径'</span></div><div class="line"></div><div class="line">files.download(FILE_PATH)</div></pre></td></tr></table></figure>
<blockquote>
<p><em>尴尬脸</em> 简单吧,简单到写不下去了</p>
</blockquote>
<h4 id="大文件"><a href="#大文件" class="headerlink" title="大文件"></a>大文件</h4><p>大文件还是推荐打包, tar:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> auth</div><div class="line"><span class="keyword">from</span> googleapiclient.discovery <span class="keyword">import</span> build</div><div class="line"><span class="keyword">from</span> googleapiclient.http <span class="keyword">import</span> MediaFileUpload</div><div class="line"></div><div class="line"><span class="comment"># 你需要填的:</span></div><div class="line">SAVE_INTODRIVE_NAME = <span class="string">'想以什么名字保存到drive'</span></div><div class="line">FILE_PATH = <span class="string">'想下载的文件路径'</span></div><div class="line"></div><div class="line">auth.authenticate_user()</div><div class="line">drive_service = build(<span class="string">'drive'</span>, <span class="string">'v3'</span>)</div><div class="line">file_metadata = &#123;</div><div class="line">  <span class="string">'name'</span>:SAVE_INTODRIVE_NAME,</div><div class="line">  <span class="string">'mimeType'</span>: <span class="string">'text/plain'</span></div><div class="line">&#125;</div><div class="line">media = MediaFileUpload(FILE_PATH, </div><div class="line">                        mimetype=<span class="string">'text/plain'</span>,</div><div class="line">                        resumable=<span class="keyword">True</span>)</div><div class="line">created = drive_service.files().create(body=file_metadata,</div><div class="line">                                       media_body=media,</div><div class="line">                                       fields=<span class="string">'id'</span>).execute()</div><div class="line">print(<span class="string">'File ID: &#123;&#125;'</span>.format(created.get(<span class="string">'id'</span>)))</div><div class="line">print(<span class="string">'Transpose succeed.'</span>)</div></pre></td></tr></table></figure></p>
<h3 id="封装起来就轻松很多了"><a href="#封装起来就轻松很多了" class="headerlink" title="封装起来就轻松很多了"></a>封装起来就轻松很多了</h3><p>这是简单封装起来, 输入对应参数就直接使用了:<br>连接: <a href="https://drive.google.com/file/d/1L7exa7j9ALc7J_PolwzNO3PlZDBmp4C-/view?usp=sharing" target="_blank" rel="external">https://drive.google.com/file/d/1L7exa7j9ALc7J_PolwzNO3PlZDBmp4C-/view?usp=sharing</a><br><img src="/2018/02/01/部署TensorFlow到Colaboratory/pack.png" alt=""></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/MachineLearning/">MachineLearning</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Colaboratory/">Colaboratory</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-TensorFlow数据集制作实战"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/01/20/TensorFlow数据集制作实战/">TensorFlow数据集制作实战</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2018/01/20/TensorFlow数据集制作实战/" class="article-date">
	  <time datetime="2018-01-20T07:52:53.000Z" itemprop="datePublished">January 20, 2018</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>这是实战篇,往下看先</p>
</blockquote>
<h4 id="当前数据"><a href="#当前数据" class="headerlink" title="当前数据"></a>当前数据</h4><p><img src="/2018/01/20/TensorFlow数据集制作实战/all_data.png" alt=""><br>当前我有这些图片数据, 分为是飞机(plane_)和不是飞机(plane_false)的二分类数据集原图.分别存在两个不同的文件夹</p>
<ul>
<li>数据1 -&gt; 大概是1600+张</li>
<li>数据0 -&gt; 大概是160+张</li>
</ul>
<p>比例是10:1左右, 而数量1800+上来看也不是很理想,  我这里为了省事是直接水平翻转图片, 得到1800*2(待会见代码). 当然为了避免欠拟合情况当然更好的方法是挖掘更多的资源.  </p>
<h4 id="根据文件夹标签化图片"><a href="#根据文件夹标签化图片" class="headerlink" title="根据文件夹标签化图片"></a>根据文件夹标签化图片</h4><p>头部一些声明:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line">__author = <span class="string">'dobby'</span></div><div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"></div><div class="line"></div><div class="line">plane_path = <span class="string">'/Users/dobby/Documents/data_img/plane'</span></div><div class="line">UNplane_path = <span class="string">'/Users/dobby/Documents/data_img/UNplane'</span></div><div class="line">records_path = <span class="string">'/Users/dobby/Documents/data_img/train.tfrecords'</span></div><div class="line">dataset_list = []</div></pre></td></tr></table></figure></p>
<p>遍历这两个文件夹, 如果是plane文件夹,那里面存储是label=1的图片, 反之是0. 进行标签化<br>存储方式为(image_path, label)的元组 一起存储在dataset_list数组中<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">classic_data</span><span class="params">(path)</span>:</span></div><div class="line">    <span class="comment"># 根据目录标签数据</span></div><div class="line">    <span class="keyword">if</span> path == plane_path:</div><div class="line">        label = <span class="number">1</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        label = <span class="number">0</span></div><div class="line">    </div><div class="line">    file_list =  os.listdir(path)</div><div class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> file_list:</div><div class="line">        <span class="keyword">if</span> each[:<span class="number">5</span>] != <span class="string">'plane'</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        im_full_path = os.path.join(path, each)</div><div class="line">        dataset_list.append((im_full_path, label))</div></pre></td></tr></table></figure></p>
<h4 id="转为数据集"><a href="#转为数据集" class="headerlink" title="转为数据集"></a>转为数据集</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_record</span><span class="params">(data_list, should_transpose=False)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">     图片转为bytes写入</span></div><div class="line"><span class="string">     字符串也是bytes</span></div><div class="line"><span class="string">     1/0 Int</span></div><div class="line"><span class="string">    """</span></div><div class="line">    counter = <span class="number">0</span></div><div class="line">     <span class="comment"># 新建一个写入session</span></div><div class="line">    writer = tf.python_io.TFRecordWriter(records_path)</div><div class="line">    <span class="keyword">for</span> path,label <span class="keyword">in</span> data_list:</div><div class="line">        counter += <span class="number">1</span></div><div class="line">        print(<span class="string">"&#123;i&#125;,&#123;j&#125;\n"</span>.format(i=path, j=label))</div><div class="line">        <span class="comment"># 打开图片</span></div><div class="line">        img = Image.open(path)</div><div class="line">        <span class="comment"># 将图片统一大小</span></div><div class="line">        img = img.resize((<span class="number">300</span>, <span class="number">300</span>))</div><div class="line">        <span class="comment"># 转换为bytes</span></div><div class="line">        img_raw = img.tobytes()</div><div class="line">        data = tf.train.Example(</div><div class="line">            features=tf.train.Features(</div><div class="line">                feature=&#123;</div><div class="line">                    <span class="string">'label'</span>:tf.train.Feature(int64_list=tf.train.Int64List(value=[label])), <span class="comment"># 0/1 分类,所以是INT</span></div><div class="line">                    <span class="string">'image'</span>:tf.train.Feature(bytes_list=tf.train.BytesList(value=[img_raw])) <span class="comment"># 字符串/图片/语音用bytes</span></div><div class="line">                &#125;</div><div class="line">            )</div><div class="line">        )</div><div class="line">        writer.write(data.SerializeToString())</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> should_transpose:</div><div class="line">            counter += <span class="number">1</span></div><div class="line">            <span class="comment"># 将图片左右翻转后生成一张新的图片,label不变,</span></div><div class="line">            rot_img = img.transpose(Image.FLIP_LEFT_RIGHT)</div><div class="line">            rot_img_raw = rot_img.tobytes()</div><div class="line">            data_2 = tf.train.Example(</div><div class="line">                features=tf.train.Features(</div><div class="line">                    feature=&#123;</div><div class="line">                        <span class="string">'label'</span>:tf.train.Feature(int64_list=tf.train.Int64List(value=[label])),</div><div class="line">                        <span class="string">'image'</span>:tf.train.Feature(bytes_list=tf.train.BytesList(value=[rot_img_raw]))</div><div class="line">                    &#125;</div><div class="line">                )</div><div class="line">            )</div><div class="line"></div><div class="line">            writer.write(data_2.SerializeToString())</div><div class="line">    writer.close()</div><div class="line">    print(<span class="string">"写入数据集-DONE, 共存&#123;&#125;个数据"</span>.format(counter))</div></pre></td></tr></table></figure>
<ul>
<li><code>writer = tf.python_io.TFRecordWriter(records_path)</code>启动一个写入TFRecord句柄, 遍历数组取出图片和label, 将图片设置统一大小并转为bytes.</li>
<li><code>tf.train.Example(tf.train.Features)</code>是核心的处理代码, Example成TensorFlow的特定规则数据, 通过使用TFRecordWriter写入到TFRecord中.Example包含一个键值对数据结构(与dict相同), 使用属性features记录, 因此, 初始化时必须传入这个features参数</li>
<li><code>writer.write(data.SerializeToString())</code>把Example序列成字符串写入TFRecord</li>
<li><code>should_transpose=False</code>参数用来配置是否水平翻转图片, 并令数据扩大一倍</li>
<li>当然关于TFRecord的写入具体规则, 如果需要可以参考该链接<a href="http://blog.csdn.net/qq_39037910/article/details/72900308" target="_blank" rel="external">Tensorflow: 文件读写</a></li>
</ul>
<h4 id="测试是否写入成功"><a href="#测试是否写入成功" class="headerlink" title="测试是否写入成功"></a>测试是否写入成功</h4><p>执行函数代码, 需要注意, 我提前将数据存储在python的列表中的, 可以使用<code>random.shuffle</code>进行数据的洗牌<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">classic_data(plane_path)</div><div class="line">classic_data(UNplane_path)</div><div class="line">random.shuffle(dataset_list)</div><div class="line">create_record(dataset_list, should_transpose=<span class="keyword">True</span>)</div></pre></td></tr></table></figure></p>
<p>结果:<br><img src="/2018/01/20/TensorFlow数据集制作实战/succeed.png" alt=""></p>
<p>可以看到数据洗牌, 而且数据*2, 都成功做到了.<br><img src="/2018/01/20/TensorFlow数据集制作实战/tu.png" alt=""></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/MachineLearning/">MachineLearning</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TensorFlow/">TensorFlow</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-TensorFlow数据集-Dataset-API"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/01/20/TensorFlow数据集-Dataset-API/">TensorFlow数据集-Dataset-API</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2018/01/20/TensorFlow数据集-Dataset-API/" class="article-date">
	  <time datetime="2018-01-20T06:52:53.000Z" itemprop="datePublished">January 20, 2018</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>TensorFlow在学习的时候, 它是有一个mnist数据集让我们学习的. 通过batch_size来每轮数据训练的大小, 现在打算将一个我们实际的数据转换为跟mnist数据集一样的效果</p>
</blockquote>
<h4 id="内存中自定义数据"><a href="#内存中自定义数据" class="headerlink" title="内存中自定义数据"></a>内存中自定义数据</h4><blockquote>
<p> Dataset-API是1.3版引入的, 支持从内存中/硬盘中生成数据集.</p>
</blockquote>
<ul>
<li><p>一维数组<br>直接就是给到一维数组, 生成数据集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dataset = tf.data.Dataset.from_tensor_slices(np.array([<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>]))</div><div class="line">out_put=<span class="string">""""</span></div><div class="line"><span class="string">1.0</span></div><div class="line"><span class="string">2.0</span></div><div class="line"><span class="string">3.0</span></div><div class="line"><span class="string">4.0</span></div><div class="line"><span class="string">5.0</span></div><div class="line"><span class="string">"""</span></div></pre></td></tr></table></figure>
</li>
<li><p>多维数组, size=(5,2) , 可以理解为(count, dimension)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dataset = tf.data.Dataset.from_tensor_slices(np.random.uniform(size=(<span class="number">5</span>, <span class="number">2</span>)))</div><div class="line">out_put=<span class="string">"""</span></div><div class="line"><span class="string">[ 0.01721917  0.4621821 ]</span></div><div class="line"><span class="string">[ 0.58484623  0.13534625]</span></div><div class="line"><span class="string">[ 0.83591111  0.01397783]</span></div><div class="line"><span class="string">[ 0.88934806  0.97464257]</span></div><div class="line"><span class="string">[ 0.76707649  0.42036516]</span></div><div class="line"><span class="string">"""</span></div></pre></td></tr></table></figure>
</li>
<li><p>元组</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">dataset = tf.data.Dataset.from_tensor_slices(</div><div class="line">  (np.array([<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>]), np.random.uniform(size=(<span class="number">5</span>, <span class="number">2</span>)))</div><div class="line">)</div><div class="line">out_put=<span class="string">"""</span></div><div class="line"><span class="string">元组的形式:</span></div><div class="line"><span class="string">(1.0, array([ 0.41459922,  0.75492457]))</span></div><div class="line"><span class="string">(2.0, array([ 0.47954237,  0.93916116]))</span></div><div class="line"><span class="string">(3.0, array([ 0.70576017,  0.58064858]))</span></div><div class="line"><span class="string">(4.0, array([ 0.8239234 ,  0.92814029]))</span></div><div class="line"><span class="string">(5.0, array([ 0.03073594,  0.16718188]))</span></div><div class="line"><span class="string">"""</span></div></pre></td></tr></table></figure>
</li>
<li><p>字典<br>字典的格式给到,结果也是字典, 按照key索引(<strong>这种用的比较多一些</strong>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">dataset = tf.data.Dataset.from_tensor_slices(</div><div class="line">    &#123;</div><div class="line">        <span class="string">"a"</span>: np.array([<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>]),</div><div class="line">        <span class="string">"b"</span>: np.random.uniform(size=(<span class="number">5</span>, <span class="number">2</span>))</div><div class="line">    &#125;</div><div class="line">)</div><div class="line">out_put=<span class="string">"""</span></div><div class="line"><span class="string">字典的形式:</span></div><div class="line"><span class="string">&#123;'a': 1.0, 'b': array([ 0.15337225,  0.97730736])&#125;</span></div><div class="line"><span class="string">&#123;'a': 2.0, 'b': array([ 0.89860896,  0.95473649])&#125;</span></div><div class="line"><span class="string">&#123;'a': 3.0, 'b': array([ 0.79198725,  0.84507321])&#125;</span></div><div class="line"><span class="string">&#123;'a': 4.0, 'b': array([ 0.27289686,  0.56223038])&#125;</span></div><div class="line"><span class="string">&#123;'a': 5.0, 'b': array([ 0.19825011,  0.44183586])&#125;</span></div><div class="line"><span class="string">"""</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="两种输出验证方式"><a href="#两种输出验证方式" class="headerlink" title="两种输出验证方式"></a>两种输出验证方式</h4><blockquote>
<p>当内存中数据生成后, 我们通过这两种方式来验证下<br><code>dataset</code>来自上方代码</p>
</blockquote>
<ul>
<li><p>index提取(缺点是需要提前知道个数)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">iterator = dataset.make_one_shot_iterator()</div><div class="line">one_element = iterator.get_next()</div><div class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">     <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</div><div class="line">         print(sess.run(one_element))</div></pre></td></tr></table></figure>
</li>
<li><p>死循环提取, 当超过个数的时候会抛出OutOfRangeError,以此停止(<strong>因此它适合全部的场合</strong>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">iterator = dataset.make_one_shot_iterator()</div><div class="line">one_element = iterator.get_next()</div><div class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            print(sess.run(one_element))</div><div class="line">    <span class="keyword">except</span> tf.errors.OutOfRangeError:</div><div class="line">        print(<span class="string">"end!"</span>)</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="数据混淆预处理"><a href="#数据混淆预处理" class="headerlink" title="数据混淆预处理"></a>数据混淆预处理</h4><blockquote>
<p>当数据从数据集读取的时候,可能存在一些不合理性,我们需要进行混淆. 又或者你的数据不是很足够, 类似图片左右投影一般进行N*2复制来扩大数据集. 诸如此类的预处理是很有必要的.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dataset = tf.data.Dataset.from_tensor_slices(np.array([<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>]))</div></pre></td></tr></table></figure>
<ul>
<li><p>dataset.map(func), 可以理解一个很酷的装饰器,如例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dataset = dataset.map(<span class="keyword">lambda</span> x: x + <span class="number">1</span>)</div><div class="line">out_put=<span class="string">"""</span></div><div class="line"><span class="string">2.0, 3.0, 4.0, 5.0, 6.0</span></div><div class="line"><span class="string">"""</span></div></pre></td></tr></table></figure>
</li>
<li><p>dataset = dataset.batch(batch_size), 可以按batch_size格式, 无法放大</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ataset = dataset.batch(<span class="number">2</span>)</div><div class="line">out_put=<span class="string">"""</span></div><div class="line"><span class="string"># 注意上方batch原先是5的, 现在传入2之后最大只有2. </span></div><div class="line"><span class="string">2,</span></div><div class="line"><span class="string">2,</span></div><div class="line"><span class="string">1</span></div><div class="line"><span class="string">"""</span></div></pre></td></tr></table></figure>
</li>
<li><p>dataset.shuffle(buffer_size) , 按照大小进行打乱,特别注意buffer最好大于数据的数量, 详见<a href="https://stackoverflow.com/questions/46444018/meaning-of-buffer-size-in-dataset-map-dataset-prefetch-and-dataset-shuffle" target="_blank" rel="external">stackoverflow</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dataset = dataset.shuffle(buffer_size=<span class="number">5</span>)</div><div class="line">out_put=<span class="string">"""</span></div><div class="line"><span class="string">3.0</span></div><div class="line"><span class="string">1.0</span></div><div class="line"><span class="string">2.0</span></div><div class="line"><span class="string">5.0</span></div><div class="line"><span class="string">4.0</span></div><div class="line"><span class="string">"""</span></div></pre></td></tr></table></figure>
</li>
<li><p>dataset.repeat(repeat_count) 数据重复放大repeat_count倍, 搭配shuffle打乱更酷(数据总数*repeat_count,这样子才足以覆盖全部数据), repeat必须带有参数, 不然会无限重复下去</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dataset = dataset.repeat(<span class="number">10</span>).shuffle(buffer_size=<span class="number">1000</span>*<span class="number">10</span>)</div><div class="line"><span class="comment"># 数量太多不贴了</span></div></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/MachineLearning/">MachineLearning</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TensorFlow/">TensorFlow</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-wda玩微信跳一跳"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/12/30/wda玩微信跳一跳/">wda玩微信跳一跳</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2017/12/30/wda玩微信跳一跳/" class="article-date">
	  <time datetime="2017-12-30T05:20:31.000Z" itemprop="datePublished">December 30, 2017</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>… 等我写完这个脚本,刷到了372分, 才发现Android的大佬们早就有一套操作了, 似乎想法都差不多,我的环境是在ios-mac上执行</p>
</blockquote>
<h3 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h3><h4 id="WebDriverAgent"><a href="#WebDriverAgent" class="headerlink" title="WebDriverAgent"></a>WebDriverAgent</h4><p><a href="https://github.com/facebook/WebDriverAgent" target="_blank" rel="external">https://github.com/facebook/WebDriverAgent</a><br>facebook开源的自动化驱动框架, 调的私有Api,所以执行的速度应该说是最准的,这也是这套玩法的关键点<br>需要一些环境依赖,代码clone下来之后, 得在项目路径下执行下:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./Scripts/bootstrap.sh</div></pre></td></tr></table></figure></p>
<p>xcode打开,选择Target是WebDriverAgentRunner,Test到手机(签名用个人Appid就可以,然后Test到手机后,信任一下证书)<br><img src="/2017/12/30/wda玩微信跳一跳/wdaAgent.png" alt=""></p>
<h4 id="facebook-wda"><a href="#facebook-wda" class="headerlink" title="facebook-wda"></a>facebook-wda</h4><p><a href="https://github.com/openatx/facebook-wda" target="_blank" rel="external">https://github.com/openatx/facebook-wda</a><br>wda,一个python脚本,配合WebDriverAgent使用,便捷的安装方法:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo pip install --pre facebook-wda</div></pre></td></tr></table></figure></p>
<h4 id="测试下环境"><a href="#测试下环境" class="headerlink" title="测试下环境"></a>测试下环境</h4><p>用个终端端口转发下(iproxy 可以通过 brew install usbmuxd安装):<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iproxy 8100 8100</div></pre></td></tr></table></figure></p>
<p>用以下命令启动下WebDriverAgent,你需要改下下方的name=你自己的手机名:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xcodebuild -project WebDriverAgent.xcodeproj -scheme WebDriverAgentRunner -destination 'platform=iOS,name=YourDeviceName' test</div></pre></td></tr></table></figure></p>
<p>看到输出这个就启动正常了:<br><img src="/2017/12/30/wda玩微信跳一跳/startAgent.png" alt=""></p>
<p>另开个终端,启动下python,如下测试下:<br><img src="/2017/12/30/wda玩微信跳一跳/pyhonTest.png" alt=""></p>
<h3 id="脚本实现"><a href="#脚本实现" class="headerlink" title="脚本实现:"></a>脚本实现:</h3><p><a href="https://github.com/Paulswith/ToolsScript/tree/master/Wechat_jump_game" target="_blank" rel="external">git代码地址-python3.6.3</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">IMAGE_PLACE = <span class="string">'/tmp/screen.png'</span></div><div class="line">each_pixel_d = <span class="number">0.00190</span></div><div class="line"></div><div class="line">c = wda.Client()</div><div class="line">s = c.session(<span class="string">'com.tencent.xin'</span>)</div><div class="line">input(<span class="string">"请自行切换到游戏里面的界面,回车即可开始"</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_to_duration</span><span class="params">(position_list)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    勾股定理 求d=C=开根号(A^2+B^2)</span></div><div class="line"><span class="string">    """</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> position_list:</div><div class="line">        <span class="keyword">return</span></div><div class="line">    x1,y1 = position_list[<span class="number">0</span>]</div><div class="line">    x2,y2 = position_list[<span class="number">1</span>]</div><div class="line">    the_d = math.sqrt(math.pow(y2 - y1, <span class="number">2</span>) + math.pow(x2 - x1, <span class="number">2</span>))</div><div class="line">    <span class="keyword">return</span> float(<span class="string">'%.3f'</span> % (the_d * each_pixel_d))</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="keyword">while</span> <span class="number">1</span>:</div><div class="line">        x = c.screenshot(IMAGE_PLACE)</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(IMAGE_PLACE):</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        <span class="comment"># time.sleep(1)  #图片就算在了,渲染还没结束,这1秒阻塞就给了吧,或者不给,为渲染正常的以下方阴影为准</span></div><div class="line">        pl.imshow(pl.array(Image.open(IMAGE_PLACE)))</div><div class="line">        position_list = pl.ginput(<span class="number">2</span>,timeout=<span class="number">2147483647</span>)</div><div class="line">        pl.ion()</div><div class="line">        duration = change_to_duration(position_list)</div><div class="line">        pl.ioff()</div><div class="line">        <span class="keyword">if</span> duration <span class="keyword">and</span> os.path.exists(IMAGE_PLACE):</div><div class="line">            s.tap_hold(<span class="number">200</span>, <span class="number">200</span>, duration=duration)</div><div class="line">            os.remove(IMAGE_PLACE)</div></pre></td></tr></table></figure>
<p>首先进入到游戏页面,截图到本地<br>使用plt.imshow展示这张图片, 通过plt.ginput我们点击的两个点会被记录下来,<br>我们通过分析这两个点, 得到小人到对面物体的地点:<br>嗯, 勾股定理:<br><img src="/2017/12/30/wda玩微信跳一跳/calcuC.png" alt="">   </p>
<p><code>change_to_duration</code>中先勾股计算的距离d,  然后乘以每个像素点的对应的秒, <code>each_pixel_d = 0.00190</code>是我目前计算到的.应该算还挺准.最后这个方法返回的是按键时间.<br>而最终操作的方法:<br><code>s.tap_hold(200, 200, duration=duration)</code> durantion就是<code>change_to_duration</code>计算出的按键时间.</p>
<h3 id="直接使用"><a href="#直接使用" class="headerlink" title="直接使用"></a>直接使用</h3><p>启动后只需要做三步, 点击小人的底部,点击前方物体的中心,然后关闭图, 嗯就可以了, 耐心点,还是可以在朋友圈装一下下的.<br><img src="/2017/12/30/wda玩微信跳一跳/the_d.png" alt=""></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/Python/">Python</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/自动化/">自动化</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-探探逆向之旅"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/12/18/探探逆向之旅/">探探逆向之旅</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2017/12/18/探探逆向之旅/" class="article-date">
	  <time datetime="2017-12-18T07:27:30.000Z" itemprop="datePublished">December 18, 2017</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>一阵子下来才明白,逆向其实会上瘾,尤其是我这种~ 天生就爱搞破坏的坏孩子来讲<br>探探是一个社交APP, 似乎不少人在上面找到另一半的. 这种卡片社交简单,背后隐藏的推荐逻辑,筛选逻辑才是它能如此盛名的原因.<br>要重点说明,这些需求是我一产品的同学给我提的, 绝非个人偏好~ 我不是那种人…</p>
</blockquote>
<h3 id="梗概"><a href="#梗概" class="headerlink" title="梗概"></a>梗概</h3><h4 id="先上下图"><a href="#先上下图" class="headerlink" title="先上下图"></a>先上下图</h4><p>(功能入口在 新手引导-&gt;探探怎么玩-&gt; ):<br><img src="/2017/12/18/探探逆向之旅/genggai.png" alt=""><br>这是目前逆向后我给它新增的功能,因为工作也比较忙,就没有新增过多的需求,但是整个App的架构逻辑其实已经很清晰了, 基本可以合理的新增一些需求在里面, 这也说明探探的开发架构逻辑挺棒的.</p>
<h4 id="功能简介"><a href="#功能简介" class="headerlink" title="功能简介"></a>功能简介</h4><p><img src="/2017/12/18/探探逆向之旅/geng.png" alt=""><br>下方是一个简单的tableview, 功能的启动都在这里,当然功能是有互斥和优先级的, </p>
<ul>
<li>同时开启无条件选妹和选妹子onlyStudent, 无条件选妹子优先. </li>
<li>为了更好的效果在主页的地方选妹子,我最后采取的是模拟点击likeButton,在NSTimer中执行,当刷的人对已拉取用户求余==0的时候停止, 如果不想停止就把infinite打开,这是一个疯狂的爬取,没有停止的线性条件,除非杀APP. 为什么这么做呢, 因为我把自动拉取的信息默认是保存到Document/cache.txt里面, 主要是照片的url和部分简介</li>
<li>自动尬聊采用的是图灵的API, 你拿到源码后需要替换为您的key, 谷歌搜索”图灵机器人”,打开后进入到某个想聊天的窗口, 它如果收到信息会自动跟她尬聊.</li>
<li>上方是用Mapkit,新增Mapview在上方,用来更改定位,然后下面的打开(不过测了下证明这块功能还有点问题的,有兴趣的哥们继续挖掘下)</li>
</ul>
<h3 id="开始调试"><a href="#开始调试" class="headerlink" title="开始调试"></a>开始调试</h3><h4 id="调试工具"><a href="#调试工具" class="headerlink" title="调试工具"></a>调试工具</h4><ul>
<li>依然是最酷的<a href="https://github.com/AloneMonkey/MonkeyDev" target="_blank" rel="external">MonkeyDev </a></li>
<li><a href="https://github.com/Flipboard/FLEX" target="_blank" rel="external">FLEX</a>(reveal过期了,这是一个很棒的替代品), 下载后编译一下, 然后按照monkeyDev中wifi加入第三方库的方式操作即可</li>
<li><a href="https://github.com/AloneMonkey/frida-ios-dump" target="_blank" rel="external">frida-ios-dump</a> 还是庆哥出品,砸壳后顺带把整个APP导出</li>
<li>其它的全程是cycript+LLDB调戏 就不累述了…<br><img src="/2017/12/18/探探逆向之旅/flex.png" alt=""> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#import &lt;FLEX/FLEXManager.h&gt;</div><div class="line">// open it in here</div><div class="line"> [[FLEXManager sharedManager] showExplorer];</div></pre></td></tr></table></figure>
</li>
</ul>
<p>导入库之后,在注入成功的这个通知回调里,启动这个方法</p>
<h4 id="调试遇到的问题"><a href="#调试遇到的问题" class="headerlink" title="调试遇到的问题"></a>调试遇到的问题</h4><p>探探是有反调试的, 用的是sysctl. 很强<br>那么你调试的时候需要讲MonkeyDev里面的打开, 这个反反调试检测默认是关闭的,原因注释上有<br><img src="/2017/12/18/探探逆向之旅/syscall.png" alt=""></p>
<h4 id="从需求粗发的debug"><a href="#从需求粗发的debug" class="headerlink" title="从需求粗发的debug"></a>从需求粗发的debug</h4><p>逆向App,我一般的套路都是酱紫.<br>设计需求 -&gt;  需求在哪里会展示 -&gt; 从view到Controller-&gt; controller方法猜测 -&gt; 结合monkeyDev进行方法trace -&gt; 确认需求方法 -&gt; hopper找方法地址 -&gt;  LLDB调试下断点 -&gt; 查看调用栈(bt) -&gt; 然后开始埋点尝试hook<br><img src="/2017/12/18/探探逆向之旅/xuxu.png" alt=""><br>用笔记在记录每次你发现的新宇宙(虽然开始的很早,实际没有时间弄它…)</p>
<h3 id="HookKKK"><a href="#HookKKK" class="headerlink" title="HookKKK"></a>HookKKK</h3><h4 id="入口"><a href="#入口" class="headerlink" title="入口"></a>入口</h4><h5 id="hook位置"><a href="#hook位置" class="headerlink" title="hook位置:"></a>hook位置:</h5><p>入口开关之所以选在 [新手引导-&gt;探探怎么玩-&gt;], 因为很符合呀,介绍都免了<br><img src="/2017/12/18/探探逆向之旅/access.png" alt=""><br>就是找到控制器后,发现这里是tableview , 直接hook了tableview的代理方法, == 0的时候进入.</p>
<h5 id="UI层设计"><a href="#UI层设计" class="headerlink" title="UI层设计:"></a>UI层设计:</h5><p>上方是mapview, 这本身就是一个内存问题,地图App都知道, 所以在dismiss的位置,需要很”干净”的把它清理一下.<br><img src="/2017/12/18/探探逆向之旅/close.png" alt=""><br>下方是tableView, 还是很简单cell注册来循环利用,省点内存</p>
<h4 id="人物存储的方式"><a href="#人物存储的方式" class="headerlink" title="人物存储的方式"></a>人物存储的方式</h4><p>探探采取CoreData进行本地存储,用户的模型是<code>UserObject</code><br><img src="/2017/12/18/探探逆向之旅/user.png" alt=""><br>简要一些浅层面我所看到的:</p>
<ul>
<li>其实又有<code>ProfileInfo</code>存储用户的一些社会内容, 里面又包含学校信息在模型<code>StudiesInfo</code>和工作信息模型<code>WorkInfo</code></li>
<li><code>LocationInfo</code>是用户的地理信息</li>
<li><code>MembershipInfo</code>似乎探探在一轮融资后要开启会员模式是真的</li>
<li><code>SettingsInfo</code>主要是你自己的一些信息,就是设置里面的,包含要不要阻拦联系人等</li>
<li>其他深一点层面诸如<code>RelationshipObject</code>/<code>HiddenUsersCollection</code>,等着有需要的去挖掘<br>其实这些都能座位你来筛选的网格,只不过你想怎么操作罢了</li>
</ul>
<h4 id="自动划妹子"><a href="#自动划妹子" class="headerlink" title="自动划妹子"></a>自动划妹子</h4><p><code>P1HomeNearbyViewController</code>是我们一进去的时候的控制器,我在<code>viewDidAppear</code>是时候进行了逻辑判断, 逻辑设置项来自<code>自定义入口</code>所写到的本地缓存,<code>1 - 0</code>字符串存储的方式进行boolValue处理:<br>全局的几个定义:<br><img src="/2017/12/18/探探逆向之旅/hong.png" alt=""><br>设置YES(1) or NO(0) 来存储:<br><img src="/2017/12/18/探探逆向之旅/value.png" alt=""><br>那么通过这样子,我们就能进行全局的逻辑判断了:<br><img src="/2017/12/18/探探逆向之旅/huameizi.png" alt=""></p>
<p>其中,我把这些我需要hook用到的头文件,从class-dump出来的抽出来, 进行@interface一下,来欺骗编译器,如果是@property就不需要继承什么, 如果是方法,报错的话可能需要继承NSObject或其他已定义的:<br><img src="/2017/12/18/探探逆向之旅/dingyi.png" alt=""></p>
<p>用起来的时候就跟正向开发很像了,你熟悉的味道:<br><img src="/2017/12/18/探探逆向之旅/use.png" alt=""><br>其中有尝试刷妹子这里,如果直接调用响应后的方法刷卡片, 会有一系列问题,最后认怂直接是模拟点击的.而且为什么用NSTimer而不是for循环之类呢,可能就是runloop层的概念了,当前运行NOPro,有兴趣的自行调戏<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[likeButton sendActionsForControlEvents:[likeButton allControlEvents]];</div></pre></td></tr></table></figure></p>
<h4 id="改定位"><a href="#改定位" class="headerlink" title="改定位"></a>改定位</h4><p>该定位和大多数的App一样,但是探探有点麻烦的是我一直就没有刷出来地图过, (听说是触发”擦肩而过”这个业务逻辑才会展示地图),业务不熟真的很不好玩~<br>因为上层展示卡片的控制器是<code>P1HomeLookingViewController</code>,我直接trace到他有返回了信息:<br><img src="/2017/12/18/探探逆向之旅/fenxi.png" alt=""></p>
<p>所以我也姑且很粗糙的做了hook,Mapview保存到配置的经纬度,在这里转为double值并返回:<br><img src="/2017/12/18/探探逆向之旅/location.png" alt=""></p>
<p>手动创建自定义的CLLocation对象,返回给它,核心方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CLLocation *lacationInfo = [[CLLocation alloc] initWithLatitude:latitude.doubleValue longitude:longitude.doubleValue];</div></pre></td></tr></table></figure></p>
<h4 id="自动尬聊"><a href="#自动尬聊" class="headerlink" title="自动尬聊"></a>自动尬聊</h4><p>尬聊是一门技术, 猿不懂, 那找会的来帮忙吧~~<br>目前实现的单个尬聊, 多个尬聊尚存在问题, 且在有限的时间内就给到这样子的需求了<br><img src="/2017/12/18/探探逆向之旅/galiao.png" alt=""><br>网络请求很粗糙了使用了NSURLSession,但能保证内存是不会问题.<br><code>#pragma mark - HOOK =&gt; &quot;-[P1ConversationTableView controller:didChangeObject:atIndexPath:forChangeType:newIndexPath:]&quot;</code><br>这个方法其实未必是很合理hook地点, 原因是存在多次抛的通知, 我进行了过滤后才拿到那条到底是她刚才发的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ConversationObject *conversation = [self conversationObject];</div><div class="line">NSComparisonResult compareResult = [[conversation latestReceivedTime] compare:[conversation latestReadMessageCreatedTime]];</div><div class="line">if (compareResult == NSOrderedDescending &amp;&amp; !conversation.isRead &amp;&amp; ![arg2.owner isCurrentUser]) &#123;</div><div class="line">            NSString *message = conversation.messageCollection.latestNormalMessage.message;</div><div class="line">            NSString *lastMessage = [TT_CONFIG objectForKey:LAST_MESSAGE];</div><div class="line">            if (![lastMessage isEqualToString:message]) &#123;  //  这里会收到重复的通知 ,可能这里并不是最佳hook的位置</div></pre></td></tr></table></figure></p>
<ul>
<li>conversation是消息的模型,每条信息对应一个conversation,第一个过滤<code>本条消息的创建时间</code> 和 <code>上条已读消息的创建时间</code>比对</li>
<li>消息不能是已读</li>
<li>消息的发送者不是自己</li>
<li>本条消息和配置的消息不同(确认是新的消息后回保存到配置,完整字符串比较)</li>
</ul>
<p>在确认是最新消息后, 通过图灵机器人的接口, POST请求出去,剩下的就是解包-&gt; 调方法发回去,其中主要的是:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">P1MessagesViewController *messageVC = (P1MessagesViewController *)[self.superview nextResponder];</div></pre></td></tr></table></figure></p>
<p>发送消息的方法在P1MessagesViewController,为了找到它,可真是废了一把劲, 最后就是这么简单</p>
<p>ano: 尬聊木有真实妹子,都是探探小助手帮的我 谢谢哦</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>逆向真的会让人上瘾 , 主要的是保持你”猥琐的”好奇心~ , 工具的使用可能都差不多,训练的是一种敏感, 对方法敏感诸如此类呀<br>从逆向我们能快速知道别人的需求做了什么,  快速了解别人的业务等,是一种很高效快速的熟悉方式.<br>至此告一段落,代码直接见我的GIT <a href="https://github.com/Paulswith/ToolsScript/tree/master/tantan_project" target="_blank" rel="external">tantan_project</a></p>
<p>[<code>仅供学习,注意尺度</code>]</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/reverseEngineering/">reverseEngineering</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向探探/">逆向探探</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Suivant</a>
  </nav>

</section>
          <aside id="sidebar">
  
    <div class="widget-wrap" style="margin: 20px 0;">
	<div id="search-form-wrap">

    <form class="search-form">
        <label style="width: 75%;">
            <span class="screen-reader-text">Search for:</span>
            <input type="search" class="search-field" style="height: 42px;" placeholder=" Rechercher…" value="" name="s" title="Search for:">
        </label>
        <input type="submit" class="search-form-submit" value="Rechercher">
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
</div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Connect With Us</h3>
    <div class="widget widget_athemes_social_icons">

    	<ul class="clearfix widget-social-icons">   
    	
          
     			  <li><a href="https://github.com/Paulswith" title="Github"><i class="fa fa-github" aria-hidden="true"></i></a></li> 
          
   		
          
            <li><a href="mailto:jevo747@gmail.com?subject=请联系我&body=我能帮你什么" title="email"><i class="fa fa-envelope" aria-hidden="true"></i></a></li> 
          
   		
   		</ul>


   		<!--
   		<ul class="clearfix widget-social-icons">   		
   		<li class="widget-si-twitter"><a href="http://twitter.com" title="Twitter"><i class="ico-twitter"></i></a></li> 
		<li class="widget-si-facebook"><a href="http://facebook.com" title="Facebook"><i class="ico-facebook"></i></a></li>
			<li class="widget-si-gplus"><a href="http://plus.google.com" title="Google+"><i class="ico-gplus"></i></a></li>
			<li class="widget-si-pinterest"><a href="http://pinterest.com" title="Pinterest"><i class="ico-pinterest"></i></a></li>
			<li class="widget-si-flickr"><a href="http://flickr.com" title="Flickr"><i class="ico-flickr"></i></a></li>
			<li class="widget-si-instagram"><a href="http://instagram.com" title="Instagram"><i class="ico-instagram"></i></a></li>
		</ul> -->

    </div>
  </div>


  
    
  <div class="widget_athemes_tabs">
    <ul id="widget-tab" class="clearfix widget-tab-nav">
      <li class="active"><a>Articles récents</a></li>
    </ul>
    <div class="widget">
      <ul>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2019/10/14/aliyun-ddns设置定时监控更新/">aliyun-ddns设置定时监控更新</a></h6>
              <span>October 14, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2018/06/20/读书记-原则/">读书记-&lt;原则&gt;</a></h6>
              <span>June 20, 2018</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2018/06/05/xcode9之后的打包方式/">xcode9之后的打包方式</a></h6>
              <span>June 5, 2018</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2018/02/25/机器学习迁移模型到IOS/">机器学习迁移模型到IOS</a></h6>
              <span>February 25, 2018</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2018/02/24/迁移学习InceptionV3/">迁移学习InceptionV3</a></h6>
              <span>February 24, 2018</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2018/02/01/部署TensorFlow到Colaboratory/">部署TensorFlow到Colaboratory</a></h6>
              <span>February 1, 2018</span>
            </div>

          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Catégories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/MachineLearning/">MachineLearning</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyProgram/">MyProgram</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Objective-C/">Objective-C</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unix/">Unix</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/macTools/">macTools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reverseEngineering/">reverseEngineering</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-clés</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/2018年读的书/">2018年读的书</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Colaboratory/">Colaboratory</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDNS/">DDNS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TensorFlow/">TensorFlow</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/brewupgradeError/">brewupgradeError</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iosDev/">iosDev</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macApp-Divvy破解/">macApp-Divvy破解</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macTools/">macTools</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/testTools/">testTools</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/verificationCode/">verificationCode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/实战去除广告/">实战去除广告</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/爬虫/">爬虫</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/砸壳/">砸壳</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自动化/">自动化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/迁移学习/">迁移学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/迁移学习移植IOS/">迁移学习移植IOS</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/逆向UNREAD/">逆向UNREAD</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/逆向探探/">逆向探探</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nuage de mot-clés</h3>
    <div class="widget tagcloud">
      <a href="/tags/2018年读的书/" style="font-size: 10px;">2018年读的书</a> <a href="/tags/Colaboratory/" style="font-size: 10px;">Colaboratory</a> <a href="/tags/DDNS/" style="font-size: 10px;">DDNS</a> <a href="/tags/TensorFlow/" style="font-size: 20px;">TensorFlow</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/brewupgradeError/" style="font-size: 10px;">brewupgradeError</a> <a href="/tags/iosDev/" style="font-size: 20px;">iosDev</a> <a href="/tags/macApp-Divvy破解/" style="font-size: 10px;">macApp-Divvy破解</a> <a href="/tags/macTools/" style="font-size: 10px;">macTools</a> <a href="/tags/shell/" style="font-size: 20px;">shell</a> <a href="/tags/testTools/" style="font-size: 10px;">testTools</a> <a href="/tags/verificationCode/" style="font-size: 10px;">verificationCode</a> <a href="/tags/实战去除广告/" style="font-size: 10px;">实战去除广告</a> <a href="/tags/爬虫/" style="font-size: 10px;">爬虫</a> <a href="/tags/砸壳/" style="font-size: 20px;">砸壳</a> <a href="/tags/自动化/" style="font-size: 10px;">自动化</a> <a href="/tags/迁移学习/" style="font-size: 10px;">迁移学习</a> <a href="/tags/迁移学习移植IOS/" style="font-size: 20px;">迁移学习移植IOS</a> <a href="/tags/逆向UNREAD/" style="font-size: 10px;">逆向UNREAD</a> <a href="/tags/逆向探探/" style="font-size: 10px;">逆向探探</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>

    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2020 In &#39;flight of thought&#39; All Rights Reserved.
          
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

<!-- Custome JS -->
<script src="/js/my.js"></script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>


<script src="/js/scripts.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="https://dnqof95d40fo6.cloudfront.net/atw7f8.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
